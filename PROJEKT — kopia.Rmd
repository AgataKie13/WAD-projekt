---
title: "Wielowymiarowa analiza jakoÅ›ci wina na podstawie danych ..."
author: "Agata Kierznikowicz, Zuzanna ÅomÅ¼a"
date: "2025-12-05"
output: rmdformats::readthedown
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
# Biblioteki:
library(readr)
library(skimr)
library(dplyr)
library(corrplot) 
library(psych)  
library(ggplot2)
library(tidyr)
library(kableExtra)
library(broom)
library(patchwork)
library(DT)
library(naniar)
library(moments)
```

# 1. Wprowadzenie

## 1.1. Motywacja i cel pracy

::: {style="text-align: justify;"}
Rezerwacje hotelowe sÄ… integralnÄ… czÄ™Å›ciÄ… branÅ¼y turystycznej i
hotelarskiej, ktÃ³ra dynamicznie siÄ™ rozwija i w ktÃ³rej decyzje biznesowe
w duÅ¼ej mierze opierajÄ… siÄ™ na danych. KaÅ¼dego dnia hotele przyjmujÄ…
setki, a nawet tysiÄ…ce goÅ›ci, a systemy rezerwacyjne gromadzÄ…
szczegÃ³Å‚owe informacje o czasie dokonania rezerwacji, liczbie osÃ³b,
dÅ‚ugoÅ›ci pobytu, typie hotelu czy dodatkowych usÅ‚ugach. ChoÄ‡ dane te sÄ…
dostÄ™pne, rzadko analizuje siÄ™ je kompleksowo, aby zrozumieÄ‡ wzorce
zachowaÅ„ klientÃ³w i czynniki wpÅ‚ywajÄ…ce na anulowanie rezerwacji.

ZbiÃ³r danych o rezerwacjach hotelowych zawiera wiele powiÄ…zanych ze sobÄ…
zmiennych, takich jak typ hotelu, czas oczekiwania na przyjazd, liczba
dorosÅ‚ych i dzieci, sezonowoÅ›Ä‡, liczba wczeÅ›niejszych anulacji czy
liczba specjalnych prÃ³Å›b. PoniewaÅ¼ cech jest wiele i mogÄ… one wpÅ‚ywaÄ‡ na
siebie nawzajem, trudno jest je analizowaÄ‡ pojedynczo. Dlatego w
projekcie zastosowano metody wielowymiarowej analizy danych, ktÃ³re
pozwalajÄ… zidentyfikowaÄ‡ najwaÅ¼niejsze zaleÅ¼noÅ›ci i wzorce w zbiorze
danych.

Celem projektu jest lepsze zrozumienie zachowaÅ„ klientÃ³w hotelowych,
identyfikacja czynnikÃ³w wpÅ‚ywajÄ…cych na anulowanie rezerwacji oraz
wykrycie naturalnych grup rezerwacji, ktÃ³re rÃ³Å¼niÄ… siÄ™ miÄ™dzy sobÄ… pod
wzglÄ™dem charakterystyki goÅ›ci i wzorcÃ³w pobytu. W tym celu wykorzystano
m.in. analizÄ™ gÅ‚Ã³wnych skÅ‚adowych (PCA), metody klasteryzacji oraz inne
techniki eksploracyjne, ktÃ³re pomagajÄ… uporzÄ…dkowaÄ‡ dane i wydobyÄ‡
najwaÅ¼niejsze informacje.

**GÅ‚Ã³wne cele projektu to:**

-   zbadanie zaleÅ¼noÅ›ci miÄ™dzy rÃ³Å¼nymi cechami rezerwacji hotelowych,
-   identyfikacja zmiennych, ktÃ³re najbardziej wpÅ‚ywajÄ… na anulowanie
    rezerwacji,
-   zastosowanie PCA do redukcji wymiarowoÅ›ci i interpretacji
    skÅ‚adowych,
-   wykrycie naturalnych grup rezerwacji przy uÅ¼yciu metod analizy
    skupieÅ„ (klastrÃ³w),
-   ocena przydatnoÅ›ci zastosowanych metod w analizie danych hotelowych
    i podejmowaniu decyzji biznesowych.
:::

## 1.2. Opis problemu badawczego

::: {style="text-align: justify;"}
PowyÅ¼ej przedstawiono ogÃ³lny kontekst problemu zwiÄ…zanego z rezerwacjami
hotelowymi. ZbiÃ³r danych zawiera wiele zmiennych opisujÄ…cych rezerwacje
â€“ zarÃ³wno cechy goÅ›ci, jak i szczegÃ³Å‚y dotyczÄ…ce pobytu czy anulowania
rezerwacji. Ich wzajemne powiÄ…zania sÄ… zÅ‚oÅ¼one i trudne do analizy bez
zastosowania odpowiednich metod statystycznych i eksploracyjnych.

W zwiÄ…zku z tym w projekcie naleÅ¼y odpowiedzieÄ‡ na kilka kluczowych
pytaÅ„ badawczych:

-   KtÃ³re cechy rezerwacji (np. czas oczekiwania na przyjazd, liczba
    osÃ³b, typ hotelu) sÄ… ze sobÄ… najsilniej powiÄ…zane?
-   KtÃ³re zmienne majÄ… najwiÄ™kszy wpÅ‚yw na anulowanie rezerwacji?
-   Czy moÅ¼na zidentyfikowaÄ‡ naturalne grupy rezerwacji, np. wedÅ‚ug
    charakterystyki goÅ›ci, typu hotelu lub wzorcÃ³w pobytu?
-   Czy zastosowanie metod redukcji wymiarowoÅ›ci (np. PCA) pozwala
    lepiej zrozumieÄ‡ strukturÄ™ danych i uÅ‚atwia interpretacjÄ™ powiÄ…zaÅ„
    miÄ™dzy zmiennymi?
:::

## 1.3. Opis danych

::: {style="text-align: justify;"}
Dane wykorzystane w projekcie pochodzÄ… z publicznego repozytorium Kaggle
i sÄ… dostÄ™pne pod adresem
<https://www.kaggle.com/datasets/mojtaba142/hotel-booking>. ZbiÃ³r
obejmuje rezerwacje dokonane w dwÃ³ch typach hoteli â€“ city hotel i resort
hotel â€“ w okresie od lipca 2015 do sierpnia 2017. Dane sÄ… kompletne,
liczne i dobrze przystosowane do analiz wielowymiarowych.

Jako **zmiennÄ… objaÅ›nianÄ…** przyjÄ™to zmiennÄ… *is_canceled*, ktÃ³ra
wskazuje, czy rezerwacja zostaÅ‚a anulowana. PozostaÅ‚e zmienne iloÅ›ciowe
i kategoryczne podzielono na grupy w zaleÅ¼noÅ›ci od ich potencjalnego
wpÅ‚ywu na ryzyko anulowania rezerwacji, co pozwala badaÄ‡ zarÃ³wno
czynniki stymulujÄ…ce, jak i hamujÄ…ce rezerwacje.

**Struktura zbioru:**

-   liczba obserwacji: 119â€¯390
-   liczba zmiennych: 32

***Zmienna objaÅ›niana:***

-   *is_canceled*

***Zmienne objaÅ›niajÄ…ce:***

*Stymulanty* - ich wzrost zmniejsza prawdopodobieÅ„stwo anulowania
pobytu:

1.  previous_bookings_not_canceled â†’ lojalnoÅ›Ä‡ klienta,,
2.  is_repeated_guest â†’ lojalnoÅ›Ä‡ klienta,
3.  total_of_special_requests â†’ wiÄ™ksze zaangaÅ¼owanie klienta,
4.  stays_in_weekend_nights â†’ dÅ‚uÅ¼szy pobyt â†’ mniejsza szansa
    anulowania,
5.  stays_in_week_nights â†’ dÅ‚uÅ¼szy pobyt â†’ mniejsza szansa anulowania,
6.  adults â†’ rezerwacje rodzinne sÄ… stabilniejsze,
7.  children â†’ rezerwacje rodzinne sÄ… stabilniejsze,
8.  babies â†’ rezerwacje rodzinne sÄ… stabilniejsze,
9.  required_car_parking_spaces â†’ klient raczej planuje przyjazd.

*Destymulanty* - ich wzrost zwiÄ™ksza ryzyko anulowania:

10. lead_time â†’ im wczeÅ›niej rezerwacja, tym wiÄ™ksza szansa anulowania,
11. previous_cancellations â†’ historia anulowaÅ„,
12. booking_changes â†’ niestabilnoÅ›Ä‡ rezerwacji,
13. days_in_waiting_list â†’ niepewnoÅ›Ä‡ dostÄ™pnoÅ›ci,
14. adr (Å›rednia cena za noc) â†’ droÅ¼sze rezerwacje czÄ™Å›ciej anulowane.

*Nominanty* - Å›wietnie nadajÄ… siÄ™ do kodowania, mogÄ… wejÅ›Ä‡ do PCA (po
kodowaniu) lub klasteryzacji

15. arrival_date_month,
16. arrival_date_week_number,
17. hotel (City / Resort),
18. market_segment,
19. distribution_channel,
20. meal,
21. country,
22. reserved_room_type,
23. assigned_room_type,
24. deposit_type,
25. customer_type.

*PozostaÅ‚e zmienne* i ich zastosowanie analityczne w projekcie

-   **arrival_date_year**, **arrival_date_day_of_month** â†’ zmienne
    czasowe, ktÃ³re moÅ¼na jedynie wykorzystaÄ‡ do analizy kontekstowej
    oraz tworzenia nowych cech;

-   **reservation_status**, **reservation_status_date** â†’ zmienne
    opisujÄ…ce status rezerwacji sÄ… bezpoÅ›rednio powiazane ze zmiennÄ…
    objaÅ›niajÄ…cÄ… *(!trzeba zrobiÄ‡ macierz korelacji!)*; zostaÅ‚y
    wykluczone z modelowania, aby uniknÄ…Ä‡ wycieku informacji (data
    leakage);

-   **agent**, **company**, **name**, **email**, **phone.number**,
    **credit_card** â†’ zmienne identyfikujÄ…ce o braku interpretacji
    ekonomicznej i istotnoÅ›ci analitycznej, zawierajÄ… bardzo duÅ¼o
    kategorii, przez co mogÄ… zdominowaÄ‡ PCA; zostaÅ‚y wykluczone z
    modelowania, ale zostajÄ… do opisu danych.
:::

```{r wczytywanie danych i przeksztaÅ‚cenia zmiennych, echo=FALSE, results='asis'}
# 1. Import danych 
hotel <- read.csv("hotel_booking.csv", header=TRUE, sep=',')

# 2. Zmiana nazw na polskie
hotel <- hotel %>%
  rename(
  "odwoÅ‚anie_rezerwacji" = "is_canceled",
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane" = "previous_bookings_not_canceled",
  "powracajÄ…cy_goÅ›Ä‡" = "is_repeated_guest",
  "liczba_specjalnych_prÃ³Å›b" = "total_of_special_requests",
  "liczba_nocy_weekendowych" = "stays_in_weekend_nights",
  "liczba_nocy_tygodniowych" = "stays_in_week_nights",
  "liczba_dorosÅ‚ych" = "adults",
  "liczba_dzieci" = "children",
  "liczba_niemowlÄ…t" = "babies",
  "wymagane_miejsca_parkingowe" = "required_car_parking_spaces",
  "czas_wyprzedzenia_rezerwacji" = "lead_time",
  "wczeÅ›niejsze_odwoÅ‚ania" = "previous_cancellations",
  "liczba_zmian_rezerwacji" = "booking_changes",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych" = "days_in_waiting_list",
  "Å›rednia_cena_za_noc" = "adr",
  "miesiÄ…c_przyjazdu" = "arrival_date_month",
  "numer_tygodnia_przyjazdu" = "arrival_date_week_number",
  "typ_hotelu" = "hotel",
  "segment_rynku" = "market_segment",
  "kanaÅ‚_dystrybucji" = "distribution_channel",
  "rodzaj_wyÅ¼ywienia" = "meal",
  "kraj_pochodzenia" = "country",
  "rodzaj_zarezerwowanego_pokoju" = "reserved_room_type",
  "rodzaj_przydzielonego_pokoju" = "assigned_room_type",
  "rodzaj_depozytu" = "deposit_type",
  "typ_klienta" = "customer_type",
  "rok_przyjazdu" = "arrival_date_year",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu" = "arrival_date_day_of_month",
  "status_rezerwacji" = "reservation_status",
  "data_statusu_rezerwacji" = "reservation_status_date",
  "agent_rezerwacji" = "agent",
  "firma" = "company",
  "imiÄ™_i_nazwisko" = "name",
  "adres_email" = "email",
  "numer_telefonu" = "phone.number",
  "numer_karty_kredytowej" = "credit_card"
)

# 3. Ustalenie wpÅ‚ywu zmiennych objaÅ›niajÄ…cych na zmiennÄ… objaÅ›nianÄ…
stymulanty <- c(
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "powracajÄ…cy_goÅ›Ä‡",
  "liczba_specjalnych_prÃ³Å›b",
  "liczba_nocy_weekendowych",
  "liczba_nocy_tygodniowych",
  "liczba_dorosÅ‚ych",
  "liczba_dzieci",
  "liczba_niemowlÄ…t",
  "wymagane_miejsca_parkingowe"
)
destymulanty <- c(
  "czas_wyprzedzenia_rezerwacji",
  "wczeÅ›niejsze_odwoÅ‚ania",
  "liczba_zmian_rezerwacji",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "Å›rednia_cena_za_noc"
)
nominanty <- c(
  "miesiÄ…c_przyjazdu",
  "numer_tygodnia_przyjazdu",
  "typ_hotelu",
  "segment_rynku",
  "kanaÅ‚_dystrybucji",
  "rodzaj_wyÅ¼ywienia",
  "kraj_pochodzenia",
  "rodzaj_zarezerwowanego_pokoju",
  "rodzaj_przydzielonego_pokoju",
  "rodzaj_depozytu",
  "typ_klienta"
)
inne <- c(
  "rok_przyjazdu",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu",
  "status_rezerwacji",
  "data_statusu_rezerwacji",
  "agent_rezerwacji",
  "firma",
  "imiÄ™_i_nazwisko",
  "adres_email",
  "numer_telefonu",
  "numer_karty_kredytowej"
)

# 4. Tabela podsumowujÄ…ca
metadata <- tibble(
  zmienna = names(hotel),
  typ_danych = sapply(hotel, class),
  stymulanta_destymulanta = case_when(
    names(hotel) %in% stymulanty ~ "stymulanta",
    names(hotel) %in% destymulanty ~ "destymulanta",
    names(hotel) %in% nominanty ~ "nominanta",
    names(hotel) %in% inne ~ "inne",
    TRUE ~ "zmienna objaÅ›niana"
  )
) %>%
  mutate(kolejnosc = case_when(
    stymulanta_destymulanta == "zmienna objaÅ›niana" ~ 1,
    stymulanta_destymulanta == "stymulanta" ~ 2,
    stymulanta_destymulanta == "destymulanta" ~ 3,
    stymulanta_destymulanta == "nominanta" ~ 4,
    TRUE ~ 5
  )) %>%
  arrange(kolejnosc, zmienna) %>%
  select(-kolejnosc)

metadata %>%
  datatable(
    rownames = FALSE,
    options = list(pageLength = 15),
    class = "stripe hover"
  ) %>%
  formatStyle(
    "stymulanta_destymulanta",
    backgroundColor = styleEqual(
      c("zmienna objaÅ›niana", "stymulanta", "destymulanta", "nominanta", "inne"),
      c("#d1e7dd", "#e7f1ff", "#f8d7da", "#fff3cd", "#e2e3e5")
    )
  )
```

## 1.4. Identyfikacja zmiennych binarnych

```{r zmienne binarne, echo=FALSE}
is_binary <- function(x) {
  is.numeric(x) && all(na.omit(x) %in% c(0,1))
}

binarne <- sapply(hotel, is_binary)

cat("Zmienne binarne: ")
cat(paste(names(binarne[binarne]), collapse = ", "))
```

::: {style="text-align: justify;"}
W zbiorze pznajdujÄ… siÄ™ dwie zmienne binarne:mzmienna objaÅ›niana -
*odwoÅ‚anie_rezerwacji* oraz zmienna objaÅ›niajÄ…ca *powracajÄ…cy_goÅ›Ä‡*.
:::

# 2. Analiza eksploracyjna danych

## 2.1. Podstawowe statystyki opisowe

```{r statystyki, echo=FALSE}
# 1. Lista zmiennych
zmienne_ilosciowe <- c(
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "liczba_specjalnych_prÃ³Å›b",
  "liczba_nocy_weekendowych",
  "liczba_nocy_tygodniowych",
  "liczba_dorosÅ‚ych",
  "liczba_dzieci",
  "liczba_niemowlÄ…t",
  "wymagane_miejsca_parkingowe",
  "czas_wyprzedzenia_rezerwacji",
  "wczeÅ›niejsze_odwoÅ‚ania",
  "liczba_zmian_rezerwacji",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "Å›rednia_cena_za_noc"
)

zmienne_kategoryczne <- c(
  "typ_hotelu",
  "rodzaj_wyÅ¼ywienia",
  "segment_rynku",
  "kanaÅ‚_dystrybucji",
  "rodzaj_zarezerwowanego_pokoju",
  "rodzaj_przydzielonego_pokoju",
  "rodzaj_depozytu",
  "typ_klienta",
  "miesiÄ…c_przyjazdu",
  "numer_tygodnia_przyjazdu",
  "rok_przyjazdu",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu",
  "status_rezerwacji"
)

zmienne_binarne <- c(
   "odwoÅ‚anie_rezerwacji",
   "powracajÄ…cy_goÅ›Ä‡"  
)

# 2. Statystyki opisowe dla zmiennych iloÅ›ciowych
ilosciowe_tbl <- data.frame(
  zmienna = as.character(zmienne_ilosciowe),
  min = sapply(hotel[zmienne_ilosciowe], function(x) min(x, na.rm = TRUE)),
  max = sapply(hotel[zmienne_ilosciowe], function(x) max(x, na.rm = TRUE)),
  Å›rednia = round(sapply(hotel[zmienne_ilosciowe], function(x) mean(x, na.rm = TRUE)), 2),
  sd = round(sapply(hotel[zmienne_ilosciowe], function(x) sd(x, na.rm = TRUE)), 2),
  Q1 = sapply(hotel[zmienne_ilosciowe], function(x) quantile(x, 0.25, na.rm = TRUE)),
  mediana = sapply(hotel[zmienne_ilosciowe], function(x) median(x, na.rm = TRUE)),
  Q3 = sapply(hotel[zmienne_ilosciowe], function(x) quantile(x, 0.75, na.rm = TRUE)),
  row.names = NULL
)

# 3. Statystyki opisowe dla zmiennych binarnych
binarne_tbl <- data.frame(
  zmienna = as.character(zmienne_binarne),
  min = 0,
  max = 1,
  Å›rednia = round(sapply(hotel[binarne], function(x) mean(x, na.rm = TRUE)), 2),
  sd = round(sapply(hotel[binarne], function(x) sd(x, na.rm = TRUE)), 2),
  Procent_1 = paste0(round(sapply(hotel[binarne], function(x) mean(x, na.rm = TRUE)*100), 2), "%"),
  row.names = NULL
)

# 4. Statystyki opisowe dla zmiennych kategorycznych
categorical_summary <- function(df, vars) {
  res <- data.frame()
  for(v in vars) {
    tbl <- table(df[[v]])
    tbl <- sort(tbl, decreasing = TRUE)
    top_values <- paste(names(tbl)[1:min(3, length(tbl))], collapse = ", ")
    top_pct <- paste(round(prop.table(tbl[1:min(3, length(tbl))])*100, 2)[1:min(3, length(tbl))], collapse = "%, ")
    tmp <- data.frame(
      zmienna = as.character(v),
      NajczÄ™stsze = paste0(top_values, " (", top_pct, "%)")
    )
    res <- rbind(res, tmp)
  }
  return(res)
}

kategoryczne_tbl <- categorical_summary(hotel, zmienne_kategoryczne)

# 5. WyÅ›wietlenie tabel
ilosciowe_tbl %>%
  datatable(caption = "Zmienne iloÅ›ciowe", rownames = FALSE, options = list(paging = FALSE))

binarne_tbl %>%
  datatable(caption = "Zmienne binarne", rownames = FALSE, options = list(paging = FALSE))

kategoryczne_tbl %>%
  datatable(caption = "Zmienne kategoryczne", rownames = FALSE, options = list(paging = FALSE))


###### Propozycja obliczania i wyÅ›wietlania statystyk "NajczÄ™stszych" dla zmiennych kategorycznych
categorical_summary <- function(df, vars, top_n = 3) {
  res <- list()

  for (v in vars) {
    tbl <- sort(table(df[[v]]), decreasing = TRUE)
    pct <- round(prop.table(tbl) * 100, 2)

    out <- data.frame(
      zmienna = v,
      Top1 = names(tbl)[1],
      Top1_pct = pct[1],
      Top2 = ifelse(length(tbl) >= 2, names(tbl)[2], NA),
      Top2_pct = ifelse(length(tbl) >= 2, pct[2], NA),
      Top3 = ifelse(length(tbl) >= 3, names(tbl)[3], NA),
      Top3_pct = ifelse(length(tbl) >= 3, pct[3], NA)
    )

    res[[v]] <- out
  }

  bind_rows(res)
}

kategoryczne_tbl <- categorical_summary(hotel, zmienne_kategoryczne)

kategoryczne_tbl %>%
  rename_with(~ c("%_Top1","%_Top2","%_Top3"), .cols = c(Top1_pct, Top2_pct, Top3_pct)) %>%
  datatable(caption = "Zmienne kategoryczne", rownames = FALSE, options = list(paging = FALSE)) %>%
  formatRound(c("%_Top1","%_Top2","%_Top3"), 1)
######
```

::: {style="text-align: justify;"}
Przeprowadzono analizÄ™ statystycznÄ… zmiennych iloÅ›ciowych, binarnych
oraz kategorycznych. **Zmienne iloÅ›ciowe** opisano za pomocÄ…
nastÄ™pujÄ…cych statystyk: wartoÅ›Ä‡ minimalna i maksymalna, Å›rednia,
odchylenie standardowe oraz kwantyle 1, 2 (mediana) i 3. NiepokojÄ…ca
jest ujemna wartoÅ›Ä‡ *Å›redniej ceny za noc*, ktÃ³rÄ… poddano dodatkowej
analizie w kolejnych etapach przetwarzania danych.

W zbiorze znajdujÄ… siÄ™ rÃ³wnieÅ¼ dwie **zmienne binarne**: zmienna
objaÅ›niana *odwoÅ‚anie_rezerwacji* oraz zmienna objaÅ›niajÄ…ca
*powracajÄ…cy_goÅ›Ä‡*. Kolumna Procent_1 przedstawia odsetek obserwacji, w
ktÃ³rych zmienna przyjmuje wartoÅ›Ä‡ 1, co pozwala na wyciÄ…gniÄ™cie
pierwszych istotnych wnioskÃ³w.

**Zmienne kategoryczne** opisano pod wzglÄ™dem najczÄ™Å›ciej wystÄ™pujÄ…cych
wartoÅ›ci wraz z ich udziaÅ‚em w caÅ‚ym zbiorze.


TU TRZEBABY DODAÄ† JESZCZE FAKTYCZNY OPIS TYCH STATYSTYK (CHYBA)
:::

## 2.2. Analiza rozkÅ‚adÃ³w

### 2.2.1. Histogramy dla zmiennych iloÅ›ciowych w postaci logarytmicznej

```{r histogramy iloÅ›ciowe log, echo=FALSE}
logarytm <- c("wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
              "liczba_dzieci",
              "liczba_niemowlÄ…t",
              "wymagane_miejsca_parkingowe",
              "wczeÅ›niejsze_odwoÅ‚ania",
              "liczba_zmian_rezerwacji",
              "liczba_dni_na_liÅ›cie_oczekujÄ…cych")

for (var in logarytm) {
  range_var <- max(hotel[[var]], na.rm = TRUE) - min(hotel[[var]], na.rm = TRUE)
  binwidth <- max(1, range_var / 30)
  
  p <- ggplot(hotel, aes(x = .data[[var]])) +
    geom_histogram(aes(y = after_stat(count) + 1),  # dodajemy 1, Å¼eby log(0) nie byÅ‚o
                   fill = "#21908d", color = "white", binwidth = binwidth) +
    scale_y_log10() +
    labs(x = var,
         y = "Liczba obserwacji (log)",
         title = paste("Histogram:", var)) +
    theme_minimal()
  
  print(p)
}
```

::: {style="text-align: justify;"}
Histogramy zmiennych iloÅ›ciowych zaprezentowano z wykorzystaniem
logarytmicznej osi OY, co pozwoliÅ‚o odsÅ‚oniÄ‡ strukturÄ™ rozkÅ‚adÃ³w
niewidocznÄ… przy klasycznej skali. Wynika to z faktu, Å¼e we wszystkich
przypadkach zdecydowanie dominuje wartoÅ›Ä‡ â€0â€, skutecznie maskujÄ…ca
zrÃ³Å¼nicowanie pozostaÅ‚ych obserwacji. RozkÅ‚ady zmiennych *liczba
dzieci*, *liczba niemowlÄ…t* oraz *wymagane miejsca parkingowe*
charakteryzujÄ… siÄ™ wyraÅºnym skupieniem obserwacji w dolnym zakresie oraz
obecnoÅ›ciÄ… wartoÅ›ci skrajnych (np. 10 dzieci w jednej obserwacji), ktÃ³re
zostanÄ… odpowiednio przeksztaÅ‚cone w dalszej czÄ™Å›ci analizy. Z kolei
zmienne *wczeÅ›niejsze rezerwacje nieodwoÅ‚ane*, *liczba zmian rezerwacji*
oraz *liczba dni na liÅ›cie oczekujÄ…cych* wykazujÄ… mniejsze
zrÃ³Å¼nicowanie - odchylenia od wartoÅ›ci centralnych sÄ… ograniczone, a
rozkÅ‚ady pozostajÄ… bardziej zwarte. Zmienna *wczeÅ›niejsze odwoÅ‚ania*
charakteryzuje siÄ™ nieregularnym, â€poszarpanymâ€ przebiegiem, co utrudnia
jednoznacznÄ… identyfikacjÄ™ jej rozkÅ‚adu. Mimo to, podobnie jak w
przypadku pozostaÅ‚ych analizowanych zmiennych, najwiÄ™ksze zagÄ™szczenie
obserwacji wystÄ™puje w dolnym zakresie wartoÅ›ci. WspÃ³lnÄ… cechÄ…
wszystkich analizowanych zmiennych jest asymetria prawostronna, co
wskazuje na obecnoÅ›Ä‡ nielicznych, lecz istotnych obserwacji o wyÅ¼szych
wartoÅ›ciach.
:::

### 2.2.2. Histogramy dla pozostaÅ‚ych zmiennych iloÅ›ciowych

```{r histogramy iloÅ›ciowe, echo=FALSE}
iloscowe <- c("liczba_specjalnych_prÃ³Å›b",
              "liczba_nocy_weekendowych",
              "liczba_nocy_tygodniowych",
              "liczba_dorosÅ‚ych",
              "czas_wyprzedzenia_rezerwacji"
)

for (var in iloscowe) {
  range_var <- max(hotel[[var]], na.rm = TRUE) - min(hotel[[var]], na.rm = TRUE)
  binwidth <- range_var / 30
  
  q <- ggplot(hotel, aes(x = .data[[var]])) +
    geom_histogram(fill = "steelblue", color = "white", binwidth = binwidth) +
    labs(x = var,
         y = "CzÄ™stoÅ›Ä‡",
         title = paste("Histogram:", var)) +
    theme_minimal()
  
  print(q)
}
```

::: {style="text-align: justify;"}
Analizowane piÄ™Ä‡ zmiennych liczbowych wykazuje wyraÅºnie zrÃ³Å¼nicowane
ksztaÅ‚ty rozkÅ‚adÃ³w, co widaÄ‡ na przygotowanych histogramach. W kaÅ¼dej z
nich obserwacje koncentrujÄ… siÄ™ gÅ‚Ã³wnie przy niskich wartoÅ›ciach, jednak
tylko zmienna *czas_wyprzedzenia_rezerwacji* prezentuje typowy rozkÅ‚ad
prawoskoÅ›ny, wskazujÄ…c, Å¼e wiÄ™kszoÅ›Ä‡ rezerwacji dokonywana jest z
niewielkim wyprzedzeniem, przy jednoczesnym istnieniu nielicznych,
bardzo odlegÅ‚ych terminÃ³w. W przypadku zmiennej
*liczba_nocy_tygodniowych* rozkÅ‚ad jest zbliÅ¼ony do normalnego, co
sugeruje rÃ³wnomierne rozÅ‚oÅ¼enie dÅ‚ugoÅ›ci pobytÃ³w tygodniowych wokÃ³Å‚
wartoÅ›ci Å›redniej. PozostaÅ‚e trzy zmienne - *liczba_specjalnych_prÃ³Å›b*,
*liczba_nocy_weekendowych* oraz *liczba_dorosÅ‚ych* - nie wykazujÄ…
jednoznacznych, charakterystycznych form rozkÅ‚adu. Histogramy pokazujÄ…
ich nieregularne, niejednorodne rozmieszczenie, z niewielkimi
skupieniami w dolnym zakresie i obecnoÅ›ciÄ… wartoÅ›ci odstajÄ…cych. Analiza
wizualna tych wykresÃ³w pozwala zidentyfikowaÄ‡ zarÃ³wno typowe zachowania,
jak i obserwacje nietypowe, ktÃ³re mogÄ… wymagaÄ‡ uwzglÄ™dnienia przy
dalszej modelowej analizie.
:::

### 2.2.3. Histogramy dla zmiennych kategorycznych

```{r histogramy kategoryczne, echo=FALSE}
for (var in c(zmienne_kategoryczne)) {
  if (!var %in% names(hotel)) next
  x <- hotel[[var]]
  if (all(is.na(x))) next
  
  ggplot(hotel, aes(x = .data[[var]])) +
    geom_bar(
      fill = "#21908d",
      color = "white",
      width = 0.7,    # ğŸ”¹ gruboÅ›Ä‡ sÅ‚upkÃ³w
      na.rm = TRUE
    ) +
    labs(title = var, x = "Kategoria", y = "Liczba obserwacji") +
    theme_minimal(base_size = 12) +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),
      strip.text = element_text(face = "bold"),
      panel.grid.major = element_line(color = "#eeeeee"),
      panel.grid.minor = element_blank()
    ) -> w
  print(w)
}
```

::: {style="text-align:justify;"}
Wykresy rozkÅ‚adÃ³w zmiennych kategorycznych pozwoliÅ‚y przyjrzeÄ‡ siÄ™
strukturze danych, wskazaÄ‡ dominujÄ…ce kategorie oraz wstÄ™pnie oceniÄ‡
zmienne potencjalnie wpÅ‚ywajÄ…ce na *odwoÅ‚anie_rezerwacji.* Na podstawie
wizualizacji moÅ¼na zauwaÅ¼yÄ‡, Å¼e najwiÄ™ksze zrÃ³Å¼nicowanie udziaÅ‚u odwoÅ‚aÅ„
wystÄ™puje w przypadku zmiennej *rodzaj_depozytu*, co sugeruje jej
kluczowÄ… rolÄ™ w dalszej analizie. WyraÅºne rÃ³Å¼nice miÄ™dzy kategoriami
widaÄ‡ rÃ³wnieÅ¼ w zmiennych *segment_rynku*, *kanaÅ‚_dystrybucji* oraz
*typ_klienta*, co odzwierciedla rÃ³Å¼ne profile klientÃ³w i sposoby
dokonywania rezerwacji. Zmienne takie jak *rodzaj_wyÅ¼ywienia* i
*typ_hotelu* rÃ³wnieÅ¼ wykazujÄ… dominacjÄ™ niektÃ³rych kategorii; choÄ‡ same
w sobie nie decydujÄ… bezpoÅ›rednio o odwoÅ‚aniach, mogÄ… wspomagaÄ‡ analizÄ™
w poÅ‚Ä…czeniu z innymi cechami, np. cenÄ… czy dÅ‚ugoÅ›ciÄ… pobytu. Wykresy
zmiennych czasowych, *miesiÄ…c_przyjazdu* i *numer_tygodnia_przyjazdu*,
pokazujÄ… okresy planowanych pobytÃ³w i pozwalajÄ… uchwyciÄ‡ sezonowe wzorce
rezerwacji, ktÃ³re mogÄ… poÅ›rednio wpÅ‚ywaÄ‡ na czÄ™stoÅ›Ä‡ anulowaÅ„. Na tej
podstawie zmienne *rodzaj_depozytu*, *segment_rynku*,
*kanaÅ‚_dystrybucji*, *typ_klienta*, a takÅ¼e *miesiÄ…c_przyjazdu* i
*numer_tygodnia_przyjazdu* wydajÄ… siÄ™ najbardziej wartoÅ›ciowe do dalszej
analizy.
:::

::: {style="text-align:justify;"}
Analiza wykresÃ³w rozkÅ‚adÃ³w zmiennych liczbowych i kategorycznych
pozwoliÅ‚a poznaÄ‡ strukturÄ™ danych i zidentyfikowaÄ‡ obserwacje odstajÄ…ce.
W zmiennych liczbowych dominujÄ… niskie wartoÅ›ci, a niektÃ³re, jak
*czas_wyprzedzenia_rezerwacji* czy *liczba_nocy_tygodniowych*, wykazujÄ…
wyraÅºne ksztaÅ‚ty rozkÅ‚adu. WÅ›rÃ³d zmiennych kategorycznych najwiÄ™ksze
rÃ³Å¼nice w udziale odwoÅ‚aÅ„ wystÄ™pujÄ… w *rodzaj_depozytu*,
*segment_rynku*, *kanaÅ‚_dystrybucji* i *typ_klienta*, natomiast
*rodzaj_wyÅ¼ywienia*, *typ_hotelu* oraz zmienne czasowe mogÄ… peÅ‚niÄ‡ rolÄ™
wspomagajÄ…cÄ…. Wnioski z wykresÃ³w wskazujÄ…, ktÃ³re cechy warto uwzglÄ™dniÄ‡
w dalszej analizie *odwoÅ‚ania_rezerwacji*.
:::

## 2.3. Analiza korelacji

::: {style="text-align:justify;"}
AnalizÄ™ korelacji przeprowadzono dla nastÄ™pujÄ…cych zmiennych iloÅ›ciowych
oraz dla zmiennej objaÅ›nianej:

1.  wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane,
2.  liczba_specjalnych_prÃ³Å›b,
3.  liczba_nocy_weekendowych,
4.  liczba_nocy_tygodniowych,
5.  liczba_dorosÅ‚ych,
6.  liczba_dzieci,
7.  liczba_niemowlÄ…t,
8.  wymagane_miejsca_parkingowe,
9.  czas_wyprzedzenia_rezerwacji,
10. wczeÅ›niejsze_odwoÅ‚ania,
11. liczba_zmian_rezerwacji,
12. liczba_dni_na_liÅ›cie_oczekujÄ…cych,
13. Å›rednia_cena_za_noc,
14. powracajÄ…cy_goÅ›Ä‡,
15. odwoÅ‚anie_rezerwacji.
:::

```{r korelacja, echo=FALSE}
hotelkorr <- hotel %>%
  rename(
  "1" = "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "2" = "liczba_specjalnych_prÃ³Å›b",
  "3" = "liczba_nocy_weekendowych",
  "4" = "liczba_nocy_tygodniowych",
  "5" = "liczba_dorosÅ‚ych",
  "6" = "liczba_dzieci",
  "7" = "liczba_niemowlÄ…t",
  "8" = "wymagane_miejsca_parkingowe",
  "9" = "czas_wyprzedzenia_rezerwacji",
  "10" = "wczeÅ›niejsze_odwoÅ‚ania",
  "11" = "liczba_zmian_rezerwacji",
  "12" = "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "13" = "Å›rednia_cena_za_noc",
  "14" = "powracajÄ…cy_goÅ›Ä‡",
  "15" = "odwoÅ‚anie_rezerwacji"
)

zmienne_i <- c(
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "10",
  "11",
  "12",
  "13",
  "14",
  "15"
)

# 1. MACIERZ KORELACJI PEARSONA
hotel_num <- hotelkorr[, zmienne_i]
macierz_korelacji <- cor(hotel_num,
                         method = "pearson",
                         use = "pairwise.complete.obs"
)

# 1.2. WIZUALIZACJA MACIERZY KORELACJI
corrplot(macierz_korelacji, 
         method = "circle", 
         type = "upper",
         title = "Macierz korelacji - metoda kÃ³Å‚ek",
         mar = c(0,0,1,0))
```

::: {style="text-align: justify;"}
Åatwo zauwaÅ¼yÄ‡, Å¼e wÅ›rÃ³d analizowanych zmiennych nie wystÄ™puje wiele
silnych zaleÅ¼noÅ›ci. NajwiÄ™kszÄ… zaleÅ¼noÅ›Ä‡ dodatniÄ… widaÄ‡ miÄ™dzy *liczbÄ…
nocy weekendowych* oraz *liczbÄ… nocy tygodniowych*. Z kolei najbardziej
zauwaÅ¼alna zaleÅ¼noÅ›Ä‡ ujemna wystÄ™puje miÄ™dzy *liczbÄ… specjalnych prÃ³Å›b*
a *zmiennÄ… objaÅ›nianÄ…*. Kolejne zauwaÅ¼alne relacje wystÄ™pujÄ… gÅ‚Ã³wnie
przy zmiennej objaÅ›nianej. PoniÅ¼ej przeprowadzono szczegÃ³Å‚owÄ… analizÄ™
korelacji.
:::

### 2.3.1. Testy istotnoÅ›ci korelacji

```{r istotnoÅ›Ä‡ korelacji, echo=FALSE}
cat("\n2. TESTY ISTOTNOÅšCI KORELACJI:\n")
cat("\n2.1. Test istotnoÅ›ci korelacji zmiennych liczba nocy weekendowych oraz liczba nocy tygodniowych:\n")
cor_test_results2 <- cor.test(hotel$liczba_nocy_weekendowych, hotel$liczba_nocy_tygodniowych)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.2. Test istotnoÅ›ci korelacji zmiennych liczba specjalnych prÃ³Å›b oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$liczba_specjalnych_prÃ³Å›b, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.3. Test istotnoÅ›ci korelacji zmiennych wymagane miejsca parkingowe oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$wymagane_miejsca_parkingowe, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.4. Test istotnoÅ›ci korelacji zmiennych czas wyprzedzenia rezerwacji oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$czas_wyprzedzenia_rezerwacji, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.5. Test istotnoÅ›ci korelacji zmiennych wczeÅ›niejsze odwoÅ‚ania oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$wczeÅ›niejsze_odwoÅ‚ania, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.6. Test istotnoÅ›ci korelacji zmiennych liczba zmian rezerwacji oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$liczba_zmian_rezerwacji, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.7. Test istotnoÅ›ci korelacji zmiennych powracajÄ…cy_goÅ›Ä‡, oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$powracajÄ…cy_goÅ›Ä‡, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")
```

::: {style="text-align: justify;"}
Analiza korelacji wykazaÅ‚a, Å¼e wszystkie badane zaleÅ¼noÅ›ci sÄ… istotne
statystycznie (p \< 0,05), jednak w wiÄ™kszoÅ›ci przypadkÃ³w majÄ… one sÅ‚abÄ…
siÅ‚Ä™. NajsilniejszÄ…, umiarkowanÄ… dodatniÄ… korelacjÄ™ zaobserwowano
pomiÄ™dzy liczbÄ… nocy weekendowych i tygodniowych (r = 0,499). PozostaÅ‚e
zmienne wykazujÄ… jedynie sÅ‚abe lub bardzo sÅ‚abe zwiÄ…zki z odwoÅ‚aniem
rezerwacji, co oznacza, Å¼e choÄ‡ zaleÅ¼noÅ›ci te sÄ… statystycznie istotne,
ich znaczenie praktyczne jest ograniczone.
:::

## 2.4. Analiza brakÃ³w danych

```{r NA, echo=FALSE}
na_counts <- colSums(is.na(hotel))

na_tbl <- tibble(
  Zmienna = names(na_counts),
  Liczba_NA = na_counts)

datatable(
  na_tbl,
  rownames = FALSE,
  options = list(pageLength = 25, dom = 't'),
  class = "stripe hover") %>%
  formatStyle(
    "Liczba_NA",
    target = "row",
    backgroundColor = styleInterval(
      c(0),
      c("transparent", "#f8d7da")))
```

```{r procent NA, echo=FALSE}
na_pct <- tibble(
  Zmienna = c("liczba_dzieci", "firma", "agent_rezerwacji"),
  Procent_NA = c(
    mean(is.na(hotel$liczba_dzieci)),
    mean(is.na(hotel$firma)),
    mean(is.na(hotel$agent_rezerwacji))
    ) * 100
  )

datatable(
  na_pct,
  rownames = FALSE,
  class = "stripe hover compact",
  options = list(pageLength = 5, dom = 't', paging = FALSE),
  caption = "Procent brakÃ³w danych (NA) dla wskazanych zmiennych") %>%
  formatRound("Procent_NA", 2)
```

::: {style="text-align: justify;"}
Braki danych wystÄ™pujÄ… w trzech zmiennych: - *liczba_dzieci* - mniej niÅ¼
1% brakÃ³w, - *firma* - prawie 100% brakÃ³w, - *agent_rezerwacji* -
niecaÅ‚e 14% brakÃ³w.

W dalszej czÄ™Å›ci pracy zostanie omÃ³wione podejÅ›cie do ich uzupeÅ‚nienia
oraz odpowiednia â€obrÃ³bkaâ€ brakÃ³w danych, uwzglÄ™dniajÄ…ca charakter
poszczegÃ³lnych zmiennych i wpÅ‚yw na analizÄ™.
:::

## 2.5. Analiza obserwacji odstajÄ…cych

::: {style="text-align: justify;"}
Analiza obserwacji odstajÄ…cych zostaÅ‚a przeprowadzona dla zmiennych
iloÅ›ciowych.
:::

### 2.5.1 Wykresy pudeÅ‚kowe

```{r boxplot}
df_ilosciowe <- hotel %>% select(all_of(zmienne_ilosciowe))
boxplot(df_ilosciowe, main = "Analiza odchyleÅ„", las = 2)

##### PROPOZYCJA DLA WIZUALIZACJI WSTÄ˜PNEJ (ZE STANDARYZACJÄ„)
hotel %>%
  select(all_of(zmienne_ilosciowe)) %>%
  scale() %>%
  as.data.frame() %>%
  pivot_longer(
    everything(),
    names_to = "zmienna",
    values_to = "wartoÅ›Ä‡") %>%
  ggplot(aes(x = zmienna, y = wartoÅ›Ä‡)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Analiza odchyleÅ„ (standaryzacja Z-score)")
```

::: {style="text-align: justify;"}
OgÃ³lna analiza odchyleÅ„ przy wykorzystaniu boxplotÃ³w pokazuje, Å¼e sÄ…
zmienne, w ktÃ³rych wystÄ™pujÄ… wartoÅ›ci odstajÄ…ce. PoniÅ¼ej przeprowadzona
zostanie szczegÃ³Å‚owa analiza odchyleÅ„ za pomocÄ… wykresÃ³w
kwantyl-kwantyl.
:::

### 2.5.2. Wykresy kwantyl-kwantyl z okreÅ›leniem skoÅ›noÅ›ci i kurtozy

```{r qq}
wrap_title <- function(title, width = 30) {
  paste(strwrap(title, width = width), collapse = "\n")
}

num_vars <- names(df_ilosciowe)
skew_values <- numeric(length(num_vars))
kurt_values <- numeric(length(num_vars))


par(mfrow = c(1,2), mar = c(8,4,4,2))

for (i in seq(1, length(num_vars), by = 2)) {
  for (j in 0:1) {
    idx <- i + j
    if (idx <= length(num_vars)) {
      x <- na.omit(df_ilosciowe[[idx]])
      var_name <- num_vars[idx]
      
      qqnorm(x, pch = 1, frame = FALSE, main = wrap_title(paste("QQ plot:", var_name)))
      qqline(x, col = "steelblue", lwd = 2)

            skew_values[idx] <- signif(skewness(x), 3)
      kurt_values[idx] <- signif(kurtosis(x), 3)
      
      mtext(paste0("skew = ", skew_values[idx]), side = 1, line = 5)
      mtext(paste0("kurt = ", kurt_values[idx]), side = 1, line = 6)
    }
  }
}

interpretacja <- c(
  "Skrajnie dodatnio skoÅ›ny rozkÅ‚ad z bardzo ciÄ™Å¼kim ogonem, wskazujÄ…cy na pojedyncze wartoÅ›ci ekstremalne.",
  "Lekko dodatnio skoÅ›ny rozkÅ‚ad, z niewielkim wpÅ‚ywem outlierÃ³w. RozkÅ‚ad umiarkowanie spiczasty.",
  "Dodatnia skoÅ›noÅ›Ä‡ z wyraÅºnie ciÄ™Å¼kimi ogonami. Pojedyncze rezerwacje o duÅ¼ej liczbie nocy wpÅ‚ywajÄ… na spiczastoÅ›Ä‡ rozkÅ‚adu.",
  "WyraÅºna dodatnia skoÅ›noÅ›Ä‡ i ciÄ™Å¼ki ogon, zmienna zawiera istotne outliery.",
  "Bardzo duÅ¼a dodatnia skoÅ›noÅ›Ä‡ i ekstremalnie spiczasty rozkÅ‚ad. Skrajne wartoÅ›ci znaczÄ…co wpÅ‚ywajÄ… na Å›redniÄ….",
  "ZnaczÄ…ca dodatnia skoÅ›noÅ›Ä‡ i ciÄ™Å¼kie ogony, pojedyncze wartoÅ›ci odstajÄ…ce.",
  "Skrajnie dodatnio skoÅ›ny i ekstremalnie spiczasty rozkÅ‚ad. WiÄ™kszoÅ›Ä‡ wartoÅ›ci to 0 lub 1, z pojedynczymi duÅ¼ymi wartoÅ›ciami.",
  "Dodatnia skoÅ›noÅ›Ä‡ i ciÄ™Å¼kie ogony; pojedyncze rezerwacje wymagajÄ… duÅ¼o miejsc parkingowych.",
  "Lekko dodatnio skoÅ›ny rozkÅ‚ad, umiarkowanie spiczasty. RozkÅ‚ad jest stosunkowo zbliÅ¼ony do normalnego, ale z kilkoma outlierami.",
  "Skrajna dodatnia skoÅ›noÅ›Ä‡ i spiczystoÅ›Ä‡; pojedyncze rezerwacje z wieloma odwoÅ‚aniami.",
  "Silnie dodatnio skoÅ›ny z wyraÅºnym wpÅ‚ywem outlierÃ³w.",
  "Bardzo dodatnia skoÅ›noÅ›Ä‡ i spiczastoÅ›Ä‡, pojedyncze rezerwacje oczekujÄ… bardzo dÅ‚ugo.",
  "Skrajnie dodatnia skoÅ›noÅ›Ä‡ i spiczastoÅ›Ä‡, obecnoÅ›Ä‡ bardzo drogich rezerwacji wypaczajÄ…cych Å›redniÄ…."
)


tabela_interp <- data.frame(
  Zmienna = num_vars,
  Skewness = skew_values,
  Kurtosis = kurt_values,
  Interpretacja = interpretacja,
  stringsAsFactors = FALSE
)
datatable(tabela_interp,
          caption = "Analiza skoÅ›noÅ›ci i kurtozy zmiennych iloÅ›ciowych",
          options = list(paging = FALSE))
```
::: {style="text-align: justify;"}
Analiza rozkÅ‚adÃ³w zmiennych iloÅ›ciowych przy uÅ¼yciu boxplotÃ³w, a takÅ¼e
wartoÅ›ci *skoÅ›noÅ›ci* (skewness) i *kurtozy* (kurtosis) pozwoliÅ‚a
zidentyfikowaÄ‡ zmienne z odchyleniami i wartoÅ›ciami odstajÄ…cymi. Wysokie
wartoÅ›ci skewness wskazujÄ… na asymetriÄ™ rozkÅ‚adu, a wysokie wartoÅ›ci
kurtosis â€“ na spiczastoÅ›Ä‡ i ciÄ™Å¼kie ogony. W takich przypadkach lepszÄ…
miarÄ… tendencji centralnej niÅ¼ Å›rednia jest mediana. SzczegÃ³Å‚owe
interpretacje dla kaÅ¼dej zmiennej znajdujÄ… siÄ™ w powyÅ¼szej tabeli.
:::

### 2.5.3. Wielowymiarowa analiza odchyleÅ„ wzglÄ™dem zmiennej objaÅ›nianej

::: {style="text-align: justify;"}
W kolejnym kroku przeprowadzono wielowymiarowÄ… analizÄ™ odchyleÅ„ z
wykorzystaniem relacji miÄ™dzy zmiennÄ… objaÅ›nianÄ… *odwoÅ‚anie rezerwacji*
a zmiennymi objaÅ›niajÄ…cymi.
:::
```{r wielowymiarowa ao}
layout(matrix(c(1, 2), nrow = TRUE, byrow = 2), heights = c(4, 1, 1))

for (var in zmienne_ilosciowe) {
  # Tworzymy formuÅ‚Ä™ dynamicznie
  f <- as.formula(paste("odwoÅ‚anie_rezerwacji ~", var))
  
  # Dopasowujemy model liniowy
  fit <- lm(f, data = hotel)
  
  # Wykres diagnostyczny Cooka
  plot(fit, which = 4, main = paste("OdwoÅ‚anie rezerwacji ~\n", var))
}
```
::: {style="text-align: justify;"}
Analiza odlegÅ‚oÅ›ci Cooka dla poszczegÃ³lnych zmiennych objaÅ›niajÄ…cych
wykazaÅ‚a zrÃ³Å¼nicowany stopieÅ„ wpÅ‚ywu obserwacji nietypowych na
stabilnoÅ›Ä‡ estymowanych parametrÃ³w modelu. SzczegÃ³lnÄ… uwagÄ™ naleÅ¼y
zwrÃ³ciÄ‡ na zmienne liczba_dorosÅ‚ych oraz Å›rednia_cena_za_noc, gdzie
zidentyfikowano punkty (m.in. nr 2174 oraz 48515) o ekstremalnie
wysokich wartoÅ›ciach statystyki $D$, siÄ™gajÄ…cych poziomu 0.8, co
wskazuje na ich krytyczny wpÅ‚yw na dopasowanie modelu. ZnaczÄ…ce wartoÅ›ci
odstajÄ…ce o charakterze punktÃ³w wpÅ‚ywowych widoczne sÄ… rÃ³wnieÅ¼ dla
zmiennych liczba_niemowlÄ…t (obserwacja 46620, $D \approx 0.3$) oraz
wymagane_miejsca_parkingowe (obserwacja 29046, $D \approx 0.15$).
Istotne zakÅ‚Ã³cenia odnotowano takÅ¼e w przypadku zmiennych
wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane oraz liczba_zmian_rezerwacji. W
pozostaÅ‚ych przypadkach, takich jak liczba specjalnych prÃ³Å›b czy czas
wyprzedzenia rezerwacji, wartoÅ›ci odlegÅ‚oÅ›ci Cooka sÄ… rzÄ™du $10^{-3}$
lub mniejsze, co sugeruje brak dominujÄ…cych outlierÃ³w zaburzajÄ…cych
wyniki. W celu zapewnienia wiarygodnoÅ›ci prognoz i unikniÄ™cia biasu
wynikajÄ…cego z jednostkowych anomalii, rekomenduje siÄ™ usuniÄ™cie
obserwacji o najwyÅ¼szym wpÅ‚ywie z wyÅ¼ej wymienionych szeÅ›ciu zmiennych,
a nastÄ™pnie ponownÄ… kalibracjÄ™ modelu na oczyszczonym zbiorze danych.
:::

# 3. Czyszczenie danych

## 3.1. ObsÅ‚uga brakÃ³w wartoÅ›ci

### 3.1.1. Analiza wystÄ™powania brakÃ³w danych

PoniÅ¼ej przeprowdzono dokÅ‚adnÄ… analizÄ™ brakÃ³w danych w zmiennych liczba_dzieci, agent_rezerwacji oraz firma, majÄ…cÄ… na celu wskazanie dalszego postÄ™powania.

```{r obsÅ‚uga NA}
hotel_miss <- hotel %>% select(liczba_dzieci, firma, agent_rezerwacji)
gg_miss_upset(hotel_miss)
```
::: {style="text-align: justify;"}
W celu dokÅ‚adniejszej analizy utworzono wykres UpSet, ktÃ³ry prezentuje wspÃ³Å‚wystÄ™powanie brakÃ³w miÄ™dzy zmiennymi. Wynika z niego, Å¼e:
- dla zmiennej liczba_dzieci wszystkie 4 braki wystÄ™pujÄ… wspÃ³Å‚zaleÅ¼nie: 2 braki z wartoÅ›ciami NA w zmiennej firma oraz 2 braki z brakami we wszystkich dwÃ³ch pozostaÅ‚ych analizowanych zmiennych;
- dla zmiennej agent_rezerwacji ok. 9,8 tys. brakÃ³w (ok. `r round(9758/16340*100, 2)`%) wystÄ™puje wspÃ³lnie z brakami w zmiennej firma, a 2 braki, jak juÅ¼ ustalono, wraz z brakami w pozostaÅ‚ych zmiennych. Natomiast blisko 6,6 tys. brakÃ³w (ok. `r round(6580/16340*100, 2)`%) wystÄ™puje niezaleÅ¼nie;
- w zmiennej firma, poza wskazanymi zaleÅ¼noÅ›ciami brakÃ³w, zdecydowana wiÄ™kszoÅ›Ä‡ wartoÅ›ci NA (ok. `r round(102831/112593*100, 2)`%) wystÄ™puje niezaleÅ¼nie.
:::

```{r test MCAR, echo=FALSE}
mcar_test(hotel_miss) %>%
  as.data.frame() %>% 
  mutate(statistic = round(statistic, 3)) %>%
  datatable(test_df,
            rownames = FALSE,
            caption = "Wyniki testu MCAR: Missing Completely At Random",
            options = list(dom = 't', paging = FALSE))
```

::: {style="text-align: justify;"}
Test Littleâ€™a dla brakÃ³w danych wykazaÅ‚ istotnoÅ›Ä‡ statystycznÄ… (Ï‡Â² =
633.62, df = 6, p \< 0.001), co pozwala odrzuciÄ‡ hipotezÄ™ zerowÄ… o
losowym wystÄ™powaniu brakÃ³w (MCAR). Oznacza to, Å¼e brakujÄ…ce wartoÅ›ci w
danych nie wystÄ™pujÄ… caÅ‚kowicie losowo i mogÄ… zaleÅ¼eÄ‡ od innych
zmiennych. W zwiÄ…zku z tym dalsza analiza wymaga zastosowania
odpowiednich metod radzenia sobie z brakami danych, takich jak imputacja
lub modele uwzglÄ™dniajÄ…ce ich obecnoÅ›Ä‡.
:::

### 3.1.2. Usuwanie brakÃ³w danych

::: {style="text-align: justify;"}
Na podstawie powyÅ¼szej analizy wysuniÄ™to nastÄ™pujÄ…ce wnioski:

- zmienna **lista_dzieci**
WartoÅ›ci NA wystÄ™pujÄ…ce w tej zmiennej stanowiÄ… marginalny odsetek obserwacji (0,003%). Ponadto, wspÃ³Å‚wystÄ™pujÄ… one z brakami w pozostaÅ‚ych analizowanych pod kÄ…dtem brakÃ³w zmiennych. Zaleca siÄ™ wobec tego usuniÄ™cie rekordÃ³w z brakami, bez stosowania imputacji.

- zmienna **agent_rezerwacji**
BrakujÄ…ce wartoÅ›ci zmiennej agent_rezerwacji stanowiÄ… 13,69% wartoÅ›ci tej zmiennej i sÄ… one w 59,72% wspÃ³Å‚zaleÅ¼ne z brakami w zmiennej firma. Wobec tego, zaleca siÄ™ zastosowanie prostej imputacji tych wartoÅ›ci Å›redniÄ… lub medianÄ… wartoÅ›ci tej zmiennej, bÄ…dÅº uzupeÅ‚nianie jej poprzez wielokrotnÄ… imputacjÄ™, np. przy pomocy pakietu "mice".
Z uwagi jednak na charakter i specyfikÄ™ wartoÅ›ci zmiennej agent_rezerwacji, tj. ID agencji podrÃ³Å¼y, ktÃ³ra dokonaÅ‚a rezerwacji, zasadnym uznano usuniÄ™cie tej zmiennej z dalszej analicy.

- zmienna **firma**
Braki w zmiennej firma, przez wzglÄ…d, iÅ¼ stanowiÄ… ponad 94% wszystkich wartoÅ›ci tej zmiennej, odbierajÄ… jej wartoÅ›Ä‡ informacyjnÄ…, wobec czego naleÅ¼y usunÄ…Ä‡ tÄ™ zmiennÄ…
:::

```{r Usuwanie brakÃ³w, include=FALSE}
# UsuniÄ™cie wierszy z brakami ze zmiennej liczba_dzieci
hotel <- hotel %>%
  filter(!is.na(liczba_dzieci))

# Usuwanie zmiennych agent_rezerwacji oraz firma
hotel <- hotel %>%
  select(-agent_rezerwacji, -firma)
```

```{r Sprawdzenie liczby NA po usuniÄ™ciu brakÃ³w, echo=FALSE}
na_counts2 <- colSums(is.na(hotel))

na_tbl2 <- tibble(
  Zmienna = names(na_counts2),
  Liczba_NA = na_counts2)

datatable(
  na_tbl2,
  rownames = FALSE,
  options = list(pageLength = 25, dom = 't'),
  caption = "Sprawdzenie liczby brakujÄ…cych wartoÅ›ci po usuniÄ™ciu ich ze zbioru danych",
  class = "stripe hover") %>%
  formatStyle(
    "Liczba_NA",
    target = "row",
    backgroundColor = styleInterval(
      c(0),
      c("transparent", "#f8d7da")))
```
Liczba obserwacji w zbiorze po usuniÄ™ciu brakÃ³w w liczba_dzieci: `r nrow(hotel)`


## 3.2. ObsÅ‚uga obserwacji odstajÄ…cych

::: {style="text-align: justify;"}
WyjaÅ›nij, co zrobiono z obserwacjami odstajÄ…cymi: â€¢ usuniÄ™cie, â€¢
wyrÃ³wnanie wartoÅ›ci odstajÄ…cych do okreÅ›lonych progÃ³w, â€¢ pozostawienie
ze wzglÄ™du na istotnoÅ›Ä‡ dla problemu

!na razie kod z czatu - trzeba przejrzeÄ‡ zajÄ™cia czy czegoÅ› nie byÅ‚o!
:::

```{r ??}
winsorize_iqr <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  pmin(pmax(x, Q1 - 1.5 * IQR), Q3 + 1.5 * IQR)
}

wina_clean <- wina
num_vars <- setdiff(names(wina)[sapply(wina, is.numeric)], "jakosc")

wina_clean[num_vars] <- lapply(wina_clean[num_vars], winsorize_iqr)

```

::: {style="text-align: justify;"}
ZmiennÄ… objaÅ›nianÄ… (jakoÅ›Ä‡ wina) pozostawiono bez modyfikacji ze wzglÄ™du
na jej kluczowe znaczenie dla problemu badawczego. Dla zmiennych
objaÅ›niajÄ…cych zastosowano wyrÃ³wnanie wartoÅ›ci odstajÄ…cych do progÃ³w
wyznaczonych na podstawie reguÅ‚y 1,5Â·IQR (winsoryzacja), co pozwoliÅ‚o
ograniczyÄ‡ wpÅ‚yw obserwacji ekstremalnych bez usuwania danych.
:::

## 3.2. Tworzenie nowych zmiennych

**MoÅ¼na dodaÄ‡ zmiennÄ… pochodnÄ…: room_changed = reserved_room_type !=
assigned_room_type**

## 3.3. Standaryzacja i normalizacja

# 4. ZASTOSOWANIE METOD WIELOWYMIAROWYCH

## 4.1. PCA â€“ Analiza gÅ‚Ã³wnych skÅ‚adowych

PCA umoÅ¼liwia redukcjÄ™ wymiarowoÅ›ci oraz ocenÄ™, ktÃ³re zmienne wyjaÅ›niajÄ…
najwiÄ™kszÄ… czÄ™Å›Ä‡ wariancji. ZostanÄ… przedstawione wartoÅ›ci wÅ‚asne,
wykres osypiska oraz biplot.

JeÅ›li stosowano metody redukcji wymiaru (np. PCA), opisz:

â€¢ jakie dane weszÅ‚y do analizy,

â€¢ ile skÅ‚adowych wybrano i dlaczego,

â€¢ jaka czÄ™Å›Ä‡ wariancji zostaÅ‚a wyjaÅ›niona.

## 4.2 Analiza skupieÅ„

ZostanÄ… zastosowane metody k-Å›rednich oraz hierarchiczna metoda Warda.
Wyniki obejmÄ… dendrogram, wykresy skupieÅ„ oraz interpretacjÄ™ klastrÃ³w
wzglÄ™dem zmiennych chemicznych.

# 5. PORÃ“WNANIE METOD I WIZUALIZACJE

PorÃ³wnane zostanÄ… wyniki PCA i klasteryzacji, a takÅ¼e ich interpretacje.
Wizualizacje obejmÄ… m.in. biploty, wykresy skupieÅ„ oraz wykresy 2D/3D
(kaÅ¼dy wykres powinien mieÄ‡ opis i krÃ³tki komentarz)
