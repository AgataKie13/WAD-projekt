---
title: "Wielowymiarowa analiza jakoÅ›ci wina na podstawie danych ..."
author: "Agata Kierznikowicz, Zuzanna ÅomÅ¼a"
date: "2025-12-05"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Biblioteki:
library(readr)
library(skimr)
library(dplyr)
library(corrplot) 
library(psych)  
library(ggplot2)
library(tidyr)
library(kableExtra)
library(broom)
library(patchwork) 
```

# 1. Wprowadzenie

## 1.1. Motywacja i cel pracy

::: {style="text-align: justify;"}
Rezerwacje hotelowe sÄ… integralnÄ… czÄ™Å›ciÄ… branÅ¼y turystycznej i
hotelarskiej, ktÃ³ra dynamicznie siÄ™ rozwija i w ktÃ³rej decyzje biznesowe
w duÅ¼ej mierze opierajÄ… siÄ™ na danych. KaÅ¼dego dnia hotele przyjmujÄ…
setki, a nawet tysiÄ…ce goÅ›ci, a systemy rezerwacyjne gromadzÄ…
szczegÃ³Å‚owe informacje o czasie dokonania rezerwacji, liczbie osÃ³b,
dÅ‚ugoÅ›ci pobytu, typie hotelu czy dodatkowych usÅ‚ugach. ChoÄ‡ dane te sÄ…
dostÄ™pne, rzadko analizuje siÄ™ je kompleksowo, aby zrozumieÄ‡ wzorce
zachowaÅ„ klientÃ³w i czynniki wpÅ‚ywajÄ…ce na anulowanie rezerwacji.

ZbiÃ³r danych o rezerwacjach hotelowych zawiera wiele powiÄ…zanych ze sobÄ…
zmiennych, takich jak typ hotelu, czas oczekiwania na przyjazd, liczba
dorosÅ‚ych i dzieci, sezonowoÅ›Ä‡, liczba wczeÅ›niejszych anulacji czy
liczba specjalnych prÃ³Å›b. PoniewaÅ¼ cech jest wiele i mogÄ… one wpÅ‚ywaÄ‡ na
siebie nawzajem, trudno jest je analizowaÄ‡ pojedynczo. Dlatego w
projekcie zastosowano metody wielowymiarowej analizy danych, ktÃ³re
pozwalajÄ… zidentyfikowaÄ‡ najwaÅ¼niejsze zaleÅ¼noÅ›ci i wzorce w zbiorze
danych.

Celem projektu jest lepsze zrozumienie zachowaÅ„ klientÃ³w hotelowych,
identyfikacja czynnikÃ³w wpÅ‚ywajÄ…cych na anulowanie rezerwacji oraz
wykrycie naturalnych grup rezerwacji, ktÃ³re rÃ³Å¼niÄ… siÄ™ miÄ™dzy sobÄ… pod
wzglÄ™dem charakterystyki goÅ›ci i wzorcÃ³w pobytu. W tym celu wykorzystano
m.in. analizÄ™ gÅ‚Ã³wnych skÅ‚adowych (PCA), metody klasteryzacji oraz inne
techniki eksploracyjne, ktÃ³re pomagajÄ… uporzÄ…dkowaÄ‡ dane i wydobyÄ‡
najwaÅ¼niejsze informacje.

**GÅ‚Ã³wne cele projektu to:**

-   zbadanie zaleÅ¼noÅ›ci miÄ™dzy rÃ³Å¼nymi cechami rezerwacji hotelowych,
-   identyfikacja zmiennych, ktÃ³re najbardziej wpÅ‚ywajÄ… na anulowanie
    rezerwacji,
-   zastosowanie PCA do redukcji wymiarowoÅ›ci i interpretacji
    skÅ‚adowych,
-   wykrycie naturalnych grup rezerwacji przy uÅ¼yciu metod analizy
    skupieÅ„ (klastrÃ³w),
-   ocena przydatnoÅ›ci zastosowanych metod w analizie danych hotelowych
    i podejmowaniu decyzji biznesowych.
:::

## 1.2. Opis problemu badawczego

::: {style="text-align: justify;"}
PowyÅ¼ej przedstawiono ogÃ³lny kontekst problemu zwiÄ…zanego z rezerwacjami
hotelowymi. ZbiÃ³r danych zawiera wiele zmiennych opisujÄ…cych rezerwacje
â€“ zarÃ³wno cechy goÅ›ci, jak i szczegÃ³Å‚y dotyczÄ…ce pobytu czy anulowania
rezerwacji. Ich wzajemne powiÄ…zania sÄ… zÅ‚oÅ¼one i trudne do analizy bez
zastosowania odpowiednich metod statystycznych i eksploracyjnych.

W zwiÄ…zku z tym w projekcie naleÅ¼y odpowiedzieÄ‡ na kilka kluczowych
pytaÅ„ badawczych:

-   KtÃ³re cechy rezerwacji (np. czas oczekiwania na przyjazd, liczba
    osÃ³b, typ hotelu) sÄ… ze sobÄ… najsilniej powiÄ…zane?
-   KtÃ³re zmienne majÄ… najwiÄ™kszy wpÅ‚yw na anulowanie rezerwacji?
-   Czy moÅ¼na zidentyfikowaÄ‡ naturalne grupy rezerwacji, np. wedÅ‚ug
    charakterystyki goÅ›ci, typu hotelu lub wzorcÃ³w pobytu?
-   Czy zastosowanie metod redukcji wymiarowoÅ›ci (np. PCA) pozwala
    lepiej zrozumieÄ‡ strukturÄ™ danych i uÅ‚atwia interpretacjÄ™ powiÄ…zaÅ„
    miÄ™dzy zmiennymi?
:::

## 1.3. Opis danych

::: {style="text-align: justify;"}
Dane wykorzystane w projekcie pochodzÄ… z publicznego repozytorium Kaggle
i sÄ… dostÄ™pne pod adresem
<https://www.kaggle.com/datasets/mojtaba142/hotel-booking>. ZbiÃ³r
obejmuje rezerwacje dokonane w dwÃ³ch typach hoteli â€“ city hotel i resort
hotel â€“ w okresie od lipca 2015 do sierpnia 2017. Dane sÄ… kompletne,
liczne i dobrze przystosowane do analiz wielowymiarowych.

Jako **zmiennÄ… objaÅ›nianÄ…** przyjÄ™to zmiennÄ… *is_canceled*, ktÃ³ra
wskazuje, czy rezerwacja zostaÅ‚a anulowana. PozostaÅ‚e zmienne iloÅ›ciowe
i kategoryczne podzielono na grupy w zaleÅ¼noÅ›ci od ich potencjalnego
wpÅ‚ywu na ryzyko anulowania rezerwacji, co pozwala badaÄ‡ zarÃ³wno
czynniki stymulujÄ…ce, jak i hamujÄ…ce rezerwacje.

**Struktura zbioru:**

-   liczba obserwacji: 119â€¯390
-   liczba zmiennych: 32

***Zmienna objaÅ›niana:***

-   *is_canceled*

***Zmienne objaÅ›niajÄ…ce:***

*Stymulanty* - ich wzrost zmniejsza prawdopodobieÅ„stwo anulowania
pobytu:

1.  previous_bookings_not_canceled â†’ lojalnoÅ›Ä‡ klienta,,
2.  is_repeated_guest â†’ lojalnoÅ›Ä‡ klienta,
3.  total_of_special_requests â†’ wiÄ™ksze zaangaÅ¼owanie klienta,
4.  stays_in_weekend_nights â†’ dÅ‚uÅ¼szy pobyt â†’ mniejsza szansa
    anulowania,
5.  stays_in_week_nights â†’ dÅ‚uÅ¼szy pobyt â†’ mniejsza szansa anulowania,
6.  adults â†’ rezerwacje rodzinne sÄ… stabilniejsze,
7.  children â†’ rezerwacje rodzinne sÄ… stabilniejsze,
8.  babies â†’ rezerwacje rodzinne sÄ… stabilniejsze,
9.  required_car_parking_spaces â†’ klient raczej planuje przyjazd.

*Destymulanty* - ich wzrost zwiÄ™ksza ryzyko anulowania:

10. lead_time â†’ im wczeÅ›niej rezerwacja, tym wiÄ™ksza szansa anulowania,
11. previous_cancellations â†’ historia anulowaÅ„,
12. booking_changes â†’ niestabilnoÅ›Ä‡ rezerwacji,
13. days_in_waiting_list â†’ niepewnoÅ›Ä‡ dostÄ™pnoÅ›ci,
14. adr (Å›rednia cena za noc) â†’ droÅ¼sze rezerwacje czÄ™Å›ciej anulowane.

*Nominanty* - Å›wietnie nadajÄ… siÄ™ do kodowania, mogÄ… wejÅ›Ä‡ do PCA (po
kodowaniu) lub klasteryzacji

15. arrival_date_month,
16. arrival_date_week_number,
17. hotel (City / Resort),
18. market_segment,
19. distribution_channel,
20. meal,
21. country,
22. reserved_room_type,
23. assigned_room_type,
24. deposit_type,
25. customer_type.

*PozostaÅ‚e zmienne* i ich zastosowanie analityczne w projekcie

-   **arrival_date_year**, **arrival_date_day_of_month** â†’ zmienne
    czasowe, ktÃ³re moÅ¼na jedynie wykorzystaÄ‡ do analizy kontekstowej
    oraz tworzenia nowych cech;

-   **reservation_status**, **reservation_status_date** â†’ zmienne
    opisujÄ…ce status rezerwacji sÄ… bezpoÅ›rednio powiazane ze zmiennÄ…
    objaÅ›niajÄ…cÄ… *(!trzeba zrobiÄ‡ macierz korelacji!)*; zostaÅ‚y
    wykluczone z modelowania, aby uniknÄ…Ä‡ wycieku informacji (data
    leakage);

-   **agent**, **company**, **name**, **email**, **phone.number**,
    **credit_card** â†’ zmienne identyfikujÄ…ce o braku interpretacji
    ekonomicznej i istotnoÅ›ci analitycznej, zawierajÄ… bardzo duÅ¼o
    kategorii, przez co mogÄ… zdominowaÄ‡ PCA; zostaÅ‚y wykluczone z
    modelowania, ale zostajÄ… do opisu danych.
:::

```{r wine, echo=FALSE, results='asis'}
# 1. Import danych 
hotel <- read.csv("hotel_booking.csv", header=TRUE, sep=',')

# 2. Zmiana nazw na polskie
hotel <- hotel %>%
  rename(
  "odwoÅ‚anie_rezerwacji" = "is_canceled",
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane" = "previous_bookings_not_canceled",
  "powracajÄ…cy_goÅ›Ä‡" = "is_repeated_guest",
  "liczba_specjalnych_prÃ³Å›b" = "total_of_special_requests",
  "liczba_nocy_weekendowych" = "stays_in_weekend_nights",
  "liczba_nocy_tygodniowych" = "stays_in_week_nights",
  "liczba_dorosÅ‚ych" = "adults",
  "liczba_dzieci" = "children",
  "liczba_niemowlÄ…t" = "babies",
  "wymagane_miejsca_parkingowe" = "required_car_parking_spaces",
  "czas_wyprzedzenia_rezerwacji" = "lead_time",
  "wczeÅ›niejsze_odwoÅ‚ania" = "previous_cancellations",
  "liczba_zmian_rezerwacji" = "booking_changes",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych" = "days_in_waiting_list",
  "Å›rednia_cena_za_noc" = "adr",
  "miesiÄ…c_przyjazdu" = "arrival_date_month",
  "numer_tygodnia_przyjazdu" = "arrival_date_week_number",
  "typ_hotelu" = "hotel",
  "segment_rynku" = "market_segment",
  "kanaÅ‚_dystrybucji" = "distribution_channel",
  "rodzaj_wyÅ¼ywienia" = "meal",
  "kraj_pochodzenia" = "country",
  "rodzaj_zarezerwowanego_pokoju" = "reserved_room_type",
  "rodzaj_przydzielonego_pokoju" = "assigned_room_type",
  "rodzaj_depozytu" = "deposit_type",
  "typ_klienta" = "customer_type",
  "rok_przyjazdu" = "arrival_date_year",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu" = "arrival_date_day_of_month",
  "status_rezerwacji" = "reservation_status",
  "data_statusu_rezerwacji" = "reservation_status_date",
  "agent_rezerwacji" = "agent",
  "firma" = "company",
  "imiÄ™_i_nazwisko" = "name",
  "adres_email" = "email",
  "numer_telefonu" = "phone.number",
  "numer_karty_kredytowej" = "credit_card"
)

# 3. Ustalenie wpÅ‚ywu zmiennych objaÅ›niajÄ…cych na zmiennÄ… objaÅ›nianÄ…
stymulanty <- c(
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "powracajÄ…cy_goÅ›Ä‡",
  "liczba_specjalnych_prÃ³Å›b",
  "liczba_nocy_weekendowych",
  "liczba_nocy_tygodniowych",
  "liczba_dorosÅ‚ych",
  "liczba_dzieci",
  "liczba_niemowlÄ…t",
  "wymagane_miejsca_parkingowe"
)
destymulanty <- c(
  "czas_wyprzedzenia_rezerwacji",
  "wczeÅ›niejsze_odwoÅ‚ania",
  "liczba_zmian_rezerwacji",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "Å›rednia_cena_za_noc"
)
nominanty <- c(
  "miesiÄ…c_przyjazdu",
  "numer_tygodnia_przyjazdu",
  "typ_hotelu",
  "segment_rynku",
  "kanaÅ‚_dystrybucji",
  "rodzaj_wyÅ¼ywienia",
  "kraj_pochodzenia",
  "rodzaj_zarezerwowanego_pokoju",
  "rodzaj_przydzielonego_pokoju",
  "rodzaj_depozytu",
  "typ_klienta"
)
inne <- c(
  "rok_przyjazdu",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu",
  "status_rezerwacji",
  "data_statusu_rezerwacji",
  "agent_rezerwacji",
  "firma",
  "imiÄ™_i_nazwisko",
  "adres_email",
  "numer_telefonu",
  "numer_karty_kredytowej"
)

# 4. Tabela podsumowujÄ…ca
metadata <- tibble(
  zmienna = names(hotel),
  typ_danych = sapply(hotel, class),
  stymulanta_destymulanta = case_when(
    names(hotel) %in% stymulanty ~ "stymulanta",
    names(hotel) %in% destymulanty ~ "destymulanta",
    names(hotel) %in% nominanty ~ "nominanta",
    names(hotel) %in% inne ~ "inne",
    TRUE ~ "zmienna objaÅ›niana"
  )
) %>%
  mutate(kolejnosc = case_when(
    stymulanta_destymulanta == "zmienna objaÅ›niana" ~ 1,
    stymulanta_destymulanta == "stymulanta" ~ 2,
    stymulanta_destymulanta == "destymulanta" ~ 3,
    stymulanta_destymulanta == "nominanta" ~ 4,
    TRUE ~ 5
  )) %>%
  arrange(kolejnosc, zmienna) %>%
  select(-kolejnosc)

metadata %>%
  kable("html", digits = 2, caption = "Zmienne") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")
```
## 1.4. Identyfikacja zmiennych binarnych

```{r echo=FALSE}
is_binary <- function(x) {
  is.numeric(x) && all(na.omit(x) %in% c(0,1))
}

binarne <- sapply(hotel, is_binary)

names(binarne[binarne])
```
::: {style="text-align: justify;"}
W zbiorze pznajdujÄ… siÄ™ dwie zmienne binarne:mzmienna objaÅ›niana - *odwoÅ‚anie_rezerwacji* oraz zmienna objaÅ›niajÄ…ca *powracajÄ…cy_goÅ›Ä‡*.
::::

# 2. Analiza eksploracyjna danych

## 2.1. Podstawowe statystyki opisowe

```{r echo=FALSE}
# 1. Lista zmiennych
zmienne_ilosciowe <- c(
  "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "liczba_specjalnych_prÃ³Å›b",
  "liczba_nocy_weekendowych",
  "liczba_nocy_tygodniowych",
  "liczba_dorosÅ‚ych",
  "liczba_dzieci",
  "liczba_niemowlÄ…t",
  "wymagane_miejsca_parkingowe",
  "czas_wyprzedzenia_rezerwacji",
  "wczeÅ›niejsze_odwoÅ‚ania",
  "liczba_zmian_rezerwacji",
  "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "Å›rednia_cena_za_noc"
)

zmienne_kategoryczne <- c(
  "typ_hotelu",
  "rodzaj_wyÅ¼ywienia",
  "segment_rynku",
  "kanaÅ‚_dystrybucji",
  "rodzaj_zarezerwowanego_pokoju",
  "rodzaj_przydzielonego_pokoju",
  "rodzaj_depozytu",
  "typ_klienta",
  "miesiÄ…c_przyjazdu",
  "numer_tygodnia_przyjazdu",
  "rok_przyjazdu",
  "dzieÅ„_przyjazdu_w_miesiÄ…cu",
  "status_rezerwacji"
)

zmienne_binarne <- c(
   "odwoÅ‚anie_rezerwacji",
   "powracajÄ…cy_goÅ›Ä‡"  
)

# 2. Statystyki opisowe dla zmiennych iloÅ›ciowych
ilosciowe_tbl <- data.frame(
  zmienna = as.character(zmienne_ilosciowe),
  min = sapply(hotel[zmienne_ilosciowe], function(x) min(x, na.rm = TRUE)),
  max = sapply(hotel[zmienne_ilosciowe], function(x) max(x, na.rm = TRUE)),
  Å›rednia = round(sapply(hotel[zmienne_ilosciowe], function(x) mean(x, na.rm = TRUE)), 2),
  sd = round(sapply(hotel[zmienne_ilosciowe], function(x) sd(x, na.rm = TRUE)), 2),
  Q1 = sapply(hotel[zmienne_ilosciowe], function(x) quantile(x, 0.25, na.rm = TRUE)),
  mediana = sapply(hotel[zmienne_ilosciowe], function(x) median(x, na.rm = TRUE)),
  Q3 = sapply(hotel[zmienne_ilosciowe], function(x) quantile(x, 0.75, na.rm = TRUE)),
  row.names = NULL
)

# 3. Statystyki opisowe dla zmiennych binarnych
binarne_tbl <- data.frame(
  zmienna = as.character(zmienne_binarne),
  min = 0,
  max = 1,
  Å›rednia = round(sapply(hotel[binarne], function(x) mean(x, na.rm = TRUE)), 2),
  sd = round(sapply(hotel[binarne], function(x) sd(x, na.rm = TRUE)), 2),
  Procent_1 = paste0(round(sapply(hotel[binarne], function(x) mean(x, na.rm = TRUE)*100), 2), "%"),
  row.names = NULL
)

# 4. Statystyki opisowe dla zmiennych kategorycznych
categorical_summary <- function(df, vars) {
  res <- data.frame()
  for(v in vars) {
    tbl <- table(df[[v]])
    tbl <- sort(tbl, decreasing = TRUE)
    top_values <- paste(names(tbl)[1:min(3, length(tbl))], collapse = ", ")
    top_pct <- paste(round(prop.table(tbl[1:min(3, length(tbl))])*100, 2)[1:min(3, length(tbl))], collapse = "%, ")
    tmp <- data.frame(
      zmienna = as.character(v),
      NajczÄ™stsze = paste0(top_values, " (", top_pct, "%)")
    )
    res <- rbind(res, tmp)
  }
  return(res)
}

kategoryczne_tbl <- categorical_summary(hotel, zmienne_kategoryczne)

# 5. WyÅ›wietlenie tabel
ilosciowe_tbl %>%
  kable("html", caption = "Zmienne iloÅ›ciowe") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")

binarne_tbl %>%
  kable("html", caption = "Zmienne binarne") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")

kategoryczne_tbl %>%
  kable("html", caption = "Zmienne kategoryczne") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")

```

::: {style="text-align: justify;"}
Przeprowadzono analizÄ™ statystycznÄ… zmiennych iloÅ›ciowych, binarnych
oraz kategorycznych. **Zmienne iloÅ›ciowe** opisano za pomocÄ…
nastÄ™pujÄ…cych statystyk: wartoÅ›Ä‡ minimalna i maksymalna, Å›rednia,
odchylenie standardowe oraz kwantyle 1, 2 (mediana) i 3. NiepokojÄ…ca
jest ujemna wartoÅ›Ä‡ *Å›redniej ceny za noc*, ktÃ³rÄ… poddano dodatkowej
analizie w kolejnych etapach przetwarzania danych.

W zbiorze znajdujÄ… siÄ™ rÃ³wnieÅ¼ dwie **zmienne binarne**: zmienna
objaÅ›niana *odwoÅ‚anie_rezerwacji* oraz zmienna objaÅ›niajÄ…ca
*powracajÄ…cy_goÅ›Ä‡*. Kolumna Procent_1 przedstawia odsetek obserwacji, w
ktÃ³rych zmienna przyjmuje wartoÅ›Ä‡ 1, co pozwala na wyciÄ…gniÄ™cie
pierwszych istotnych wnioskÃ³w.

**Zmienne kategoryczne** opisano pod wzglÄ™dem najczÄ™Å›ciej wystÄ™pujÄ…cych
wartoÅ›ci wraz z ich udziaÅ‚em w caÅ‚ym zbiorze.
:::

## 2.2. Analiza rozkÅ‚adÃ³w

```{r}
ggplot(hotel, aes(x = wymagane_miejsca_parkingowe)) +
  geom_bar(fill = "#21908d", color = "white") +
  scale_y_log10() +  # ğŸ”¹ logarytmiczna skala
  labs(x = "Wymagane miejsca parkingowe", 
       y = "Liczba obserwacji (log)", 
       title = "Histogram miejsc parkingowych") +
  theme_minimal()

```

```{r}
# 1ï¸âƒ£ Histogramy dla zmiennych iloÅ›ciowych (oÅ› y logarytmiczna, bez problemÃ³w z zerami)
for (var in zmienne_ilosciowe) {
  if (!var %in% names(hotel)) next
  x <- hotel[[var]]
  if (all(is.na(x))) next
  
  # dynamiczny binwidth: 1% rozpiÄ™toÅ›ci danych
  xmax <- quantile(x, 0.99, na.rm = TRUE)
  xmin <- min(x, na.rm = TRUE)
  binwidth_val <- (xmax - xmin) / 30  # ok. 30 sÅ‚upkÃ³w
  
  ggplot(hotel, aes(x = .data[[var]])) +
    geom_histogram(
      aes(y = ..count.. + 1),  # ğŸ”¹ dodanie 1, Å¼eby uniknÄ…Ä‡ log(0)
      binwidth = binwidth_val,
      fill = "#440154",
      color = "white",
      na.rm = TRUE
    ) +
    coord_cartesian(xlim = c(xmin, xmax)) +
    scale_y_log10(labels = scales::comma_format()) +  # ğŸ”¹ logarytmiczna oÅ› y
    labs(title = var, x = "WartoÅ›Ä‡", y = "CzÄ™stoÅ›Ä‡ (log10)") +
    theme_minimal(base_size = 12) +
    theme(
      strip.text = element_text(face = "bold"),
      panel.grid.major = element_line(color = "#eeeeee"),
      panel.grid.minor = element_blank()
    ) -> p
  print(p)
}

```

```{r}
# 1ï¸âƒ£ Histogramy dla zmiennych iloÅ›ciowych
for (var in zmienne_ilosciowe) {
  if (!var %in% names(hotel)) next
  x <- hotel[[var]]
  if (all(is.na(x))) next
  
  # dynamiczny binwidth: 1% rozpiÄ™toÅ›ci danych
  xmax <- quantile(x, 0.99, na.rm = TRUE)
  xmin <- min(x, na.rm = TRUE)
  binwidth_val <- (xmax - xmin) / 30  # ok. 30 sÅ‚upkÃ³w
  
  ggplot(hotel, aes(x = .data[[var]])) +
    geom_histogram(
      binwidth = binwidth_val,
      fill = "#440154",
      color = "white",
      na.rm = TRUE
    ) +
    coord_cartesian(xlim = c(xmin, xmax)) +
    labs(title = var, x = "WartoÅ›Ä‡", y = "CzÄ™stoÅ›Ä‡") +
    theme_minimal(base_size = 12) +
    theme(
      strip.text = element_text(face = "bold"),
      panel.grid.major = element_line(color = "#eeeeee"),
      panel.grid.minor = element_blank()
    ) -> p
  print(p)
}

# 2ï¸âƒ£ Wykresy sÅ‚upkowe dla zmiennych kategorycznych i binarnych
for (var in c(zmienne_kategoryczne, zmienne_binarne)) {
  if (!var %in% names(hotel)) next
  x <- hotel[[var]]
  if (all(is.na(x))) next
  
  ggplot(hotel, aes(x = .data[[var]])) +
    geom_bar(
      fill = "#21908d",
      color = "white",
      width = 0.7,    # ğŸ”¹ gruboÅ›Ä‡ sÅ‚upkÃ³w
      na.rm = TRUE
    ) +
    labs(title = var, x = "Kategoria", y = "Liczba obserwacji") +
    theme_minimal(base_size = 12) +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),
      strip.text = element_text(face = "bold"),
      panel.grid.major = element_line(color = "#eeeeee"),
      panel.grid.minor = element_blank()
    ) -> p
  print(p)
}

```

::: {style="text-align:justify;"}
KOMENTARZ - KrÃ³tko skomentuj ksztaÅ‚t rozkÅ‚adu (skoÅ›noÅ›Ä‡,
obecnoÅ›Ä‡ ogonÃ³w itp.) 

!!!!!!!!!!!!!!!!!!!!!

:::

## 2.3. Analiza korelacji

AnalizÄ™ korelacji przeprowadzono dla nastÄ™pujÄ…cych zmiennych iloÅ›ciowych oraz dla zmiennej objaÅ›nianej:

1. wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane,
2. liczba_specjalnych_prÃ³Å›b,
3. liczba_nocy_weekendowych,
4. liczba_nocy_tygodniowych,
5. liczba_dorosÅ‚ych,
6. liczba_dzieci,
7. liczba_niemowlÄ…t,
8. wymagane_miejsca_parkingowe,
9. czas_wyprzedzenia_rezerwacji,
10. wczeÅ›niejsze_odwoÅ‚ania,
11. liczba_zmian_rezerwacji,
12. liczba_dni_na_liÅ›cie_oczekujÄ…cych,
13. Å›rednia_cena_za_noc,
14. powracajÄ…cy_goÅ›Ä‡,
15. odwoÅ‚anie_rezerwacji.

```{r}
hotelkorr <- hotel %>%
  rename(
  "1" = "wczeÅ›niejsze_rezerwacje_nieodwoÅ‚ane",
  "2" = "liczba_specjalnych_prÃ³Å›b",
  "3" = "liczba_nocy_weekendowych",
  "4" = "liczba_nocy_tygodniowych",
  "5" = "liczba_dorosÅ‚ych",
  "6" = "liczba_dzieci",
  "7" = "liczba_niemowlÄ…t",
  "8" = "wymagane_miejsca_parkingowe",
  "9" = "czas_wyprzedzenia_rezerwacji",
  "10" = "wczeÅ›niejsze_odwoÅ‚ania",
  "11" = "liczba_zmian_rezerwacji",
  "12" = "liczba_dni_na_liÅ›cie_oczekujÄ…cych",
  "13" = "Å›rednia_cena_za_noc",
  "14" = "powracajÄ…cy_goÅ›Ä‡",
  "15" = "odwoÅ‚anie_rezerwacji"
)


str(hotel$typ_klienta)
zmienne_i <- c(
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "10",
  "11",
  "12",
  "13",
  "14",
  "15"
)

# 1. MACIERZ KORELACJI PEARSONA
hotel_num <- hotelkorr[, zmienne_i]
macierz_korelacji <- cor(hotel_num,
                         method = "pearson",
                         use = "pairwise.complete.obs"
)

# 1.2. WIZUALIZACJA MACIERZY KORELACJI
corrplot(macierz_korelacji, 
         method = "circle", 
         type = "upper",
         title = "Macierz korelacji - metoda kÃ³Å‚ek",
         mar = c(0,0,1,0))
```
::: {style="text-align: justify;"}
Åatwo zauwaÅ¼yÄ‡, Å¼e wÅ›rÃ³d analizowanych zmiennych nie wystÄ™puje wiele silnych zaleÅ¼noÅ›ci. NajwiÄ™kszÄ… zaleÅ¼noÅ›Ä‡ dodatniÄ… widaÄ‡ miÄ™dzy *liczbÄ… nocy weekendowych* oraz *liczbÄ… nocy tygodniowych*. Z kolei najbardziej zauwaÅ¼alna zaleÅ¼noÅ›Ä‡ ujemna wystÄ™puje miÄ™dzy *liczbÄ… specjalnych prÃ³Å›b* a *zmiennÄ… objaÅ›nianÄ…*. Kolejne zauwaÅ¼alne relacje wystÄ™pujÄ… gÅ‚Ã³wnie przy zmiennej objaÅ›nianej. PoniÅ¼ej przeprowadzono szczegÃ³Å‚owÄ… analizÄ™ korelacji.
:::

### 2.3.1. Testy istotnoÅ›ci korelacji

```{r}
cat("\n2. TESTY ISTOTNOÅšCI KORELACJI:\n")
cat("\n2.1. Test istotnoÅ›ci korelacji zmiennych liczba nocy weekendowych oraz liczba nocy tygodniowych:\n")
cor_test_results2 <- cor.test(hotel$liczba_nocy_weekendowych, hotel$liczba_nocy_tygodniowych)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.2. Test istotnoÅ›ci korelacji zmiennych liczba specjalnych prÃ³Å›b oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$liczba_specjalnych_prÃ³Å›b, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.3. Test istotnoÅ›ci korelacji zmiennych wymagane miejsca parkingowe oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$wymagane_miejsca_parkingowe, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.4. Test istotnoÅ›ci korelacji zmiennych czas wyprzedzenia rezerwacji oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$czas_wyprzedzenia_rezerwacji, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.5. Test istotnoÅ›ci korelacji zmiennych wczeÅ›niejsze odwoÅ‚ania oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$wczeÅ›niejsze_odwoÅ‚ania, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.6. Test istotnoÅ›ci korelacji zmiennych liczba zmian rezerwacji oraz odwoÅ‚anie rezerwacji:\n")
cor_test_results2 <- cor.test(hotel$liczba_zmian_rezerwacji, hotel$odwoÅ‚anie_rezerwacji)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")
```
::: {style="text-align: justify;"}
Analiza korelacji wykazaÅ‚a, Å¼e wszystkie badane zaleÅ¼noÅ›ci sÄ… istotne statystycznie (p < 0,05), jednak w wiÄ™kszoÅ›ci przypadkÃ³w majÄ… one sÅ‚abÄ… siÅ‚Ä™. NajsilniejszÄ…, umiarkowanÄ… dodatniÄ… korelacjÄ™ zaobserwowano pomiÄ™dzy liczbÄ… nocy weekendowych i tygodniowych (r = 0,499). PozostaÅ‚e zmienne wykazujÄ… jedynie sÅ‚abe lub bardzo sÅ‚abe zwiÄ…zki z odwoÅ‚aniem rezerwacji, co oznacza, Å¼e choÄ‡ zaleÅ¼noÅ›ci te sÄ… statystycznie istotne, ich znaczenie praktyczne jest ograniczone.
:::

## 2.4. Analiza brakÃ³w danych

```{r}
print(colSums(is.na(hotel)))
```
```{r}
mean(is.na(hotel$liczba_dzieci)) * 100
mean(is.na(hotel$firma)) * 100
mean(is.na(hotel$agent_rezerwacji)) * 100
```
::: {style="text-align: justify;"}
Braki danych wystÄ™pujÄ… w trzech zmiennych:
-   *liczba_dzieci* - mniej niÅ¼ 1% brakÃ³w,
-   *firma* - prawie 100% brakÃ³w,
-   *agent_rezerwacji* - niecaÅ‚e 14% brakÃ³w.
:::

## 2.5. Analiza obserwacji odstajÄ…cych

```{r}
wina_long <- wina %>%
  select(where(is.numeric)) %>%
  pivot_longer(
    cols = everything(),
    names_to = "zmienna",
    values_to = "value"
  )

ggplot(wina_long, aes(y = value)) +
  geom_boxplot(
    fill = "#8DA0CB",
    color = "#4A4A4A",
    outlier.color = "#D95F02",
    outlier.alpha = 0.6
  ) +
  facet_wrap(
    ~ zmienna,
    scales = "free_y",
    nrow = 3
  ) +
  labs(
    x = NULL,
    y = "WartoÅ›Ä‡",
    title = "Analiza wartoÅ›ci odstajÄ…cych"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    strip.background = element_rect(fill = "#f7f7f7", color = NA),
    strip.text = element_text(face = "bold", size = 9),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    plot.title = element_text(face = "bold", size = 12)
  )


```

::: {style="text-align: justify;"}
Analiza rozkÅ‚adÃ³w zmiennych oraz wstÄ™pna analiza odchyleÅ„ z
wykorzystaniem boxplotÃ³w pozwoliÅ‚a zlokalizowaÄ‡ zmienne zawierajÄ…ce
odchylenia. WÅ›rÃ³d nich znajdujÄ… siÄ™ wszystkie zmienne z wyjÄ…tkiem
zmiennej alkohol.\
NastÄ™pnie przeprowadzono wielowymiarowÄ… analizÄ™ odchyleÅ„ z
wykorzystaniem relacji miÄ™dzy zmiennÄ… objaÅ›nianÄ… - jakoÅ›Ä‡ a zmiennymi
objaÅ›niajÄ…cymi.
:::

```{r}
layout(matrix(c(1, 2), nrow = TRUE, byrow = 2), heights = c(1, 1, 1))
fit1 = lm(jakoÅ›Ä‡ ~ caÅ‚kowity_dwutlenek_siarki,data=wina)
plot(fit1,which=4, main="JakoÅ›Ä‡ vs caÅ‚kowity\ndwutlenek siarki")

fit2 = lm(jakoÅ›Ä‡ ~ wolny_dwutlenek_siarki,data=wina)
plot(fit2,which=4, main="JakoÅ›Ä‡ vs wolny\ndwutlenek siarki")

fit3 = lm(jakoÅ›Ä‡ ~ lotna_kwasowoÅ›Ä‡,data=wina)
plot(fit3,which=4, main="JakoÅ›Ä‡ vs lotna kwasowoÅ›Ä‡")

fit4 = lm(jakoÅ›Ä‡ ~ staÅ‚a_kwasowoÅ›Ä‡,data=wina)
plot(fit4,which=4, main="JakoÅ›Ä‡ vs staÅ‚a kwasowoÅ›Ä‡")

fit5 = lm(jakoÅ›Ä‡ ~ chlorki,data=wina)
plot(fit5,which=4, main="JakoÅ›Ä‡ vs chlorki")

fit6 = lm(jakoÅ›Ä‡ ~ cukier_resztkowy,data=wina)
plot(fit6,which=4, main="JakoÅ›Ä‡ vs cukier resztkowy")

fit7 = lm(jakoÅ›Ä‡ ~ gÄ™stoÅ›Ä‡,data=wina)
plot(fit7,which=4, main="JakoÅ›Ä‡ vs gÄ™stoÅ›Ä‡")

fit8 = lm(jakoÅ›Ä‡ ~ kwas_cytrynowy,data=wina)
plot(fit8,which=4, main="JakoÅ›Ä‡ vs kwas cytrynowy")

fit9 = lm(jakoÅ›Ä‡ ~ pH,data=wina)
plot(fit9,which=4, main="JakoÅ›Ä‡ vs pH")

fit10 = lm(jakoÅ›Ä‡ ~ siarczany,data=wina)
plot(fit10,which=4, main="JakoÅ›Ä‡ vs siarczany")

```

::: {style="text-align: justify;"}
[z czata:] AnalizÄ™ obserwacji odstajÄ…cych przeprowadzono z
wykorzystaniem wykresÃ³w pudeÅ‚kowych oraz miar wpÅ‚ywu (Cookâ€™s distance).
Stwierdzono obecnoÅ›Ä‡ wartoÅ›ci odstajÄ…cych w rozkÅ‚adach zmiennych
chemicznych, co jest zjawiskiem typowym dla danych tego rodzaju i nie
wskazuje na bÅ‚Ä™dy pomiarowe.

Na podstawie analizy miar wpÅ‚ywu nie stwierdzono koniecznoÅ›ci usuwania
obserwacji, gdyÅ¼ pojedyncze punkty o podwyÅ¼szonej wartoÅ›ci Cookâ€™s
distance nie miaÅ‚y dominujÄ…cego wpÅ‚ywu na estymacjÄ™ modelu.
:::

# 3. ObrÃ³bka zmiennych

## 3.1. ObsÅ‚uga brakÃ³w danych

## 3.2. ObsÅ‚uga obserwacji odstajÄ…cych - jeÅ›li wystÄ™pujÄ…

!na razie kod z czatu - trzeba przejrzeÄ‡ zajÄ™cia czy czegoÅ› nie byÅ‚o!

```{r}
winsorize_iqr <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  pmin(pmax(x, Q1 - 1.5 * IQR), Q3 + 1.5 * IQR)
}

wina_clean <- wina
num_vars <- setdiff(names(wina)[sapply(wina, is.numeric)], "jakosc")

wina_clean[num_vars] <- lapply(wina_clean[num_vars], winsorize_iqr)

```

::: {style="text-align: justify;"}
ZmiennÄ… objaÅ›nianÄ… (jakoÅ›Ä‡ wina) pozostawiono bez modyfikacji ze wzglÄ™du
na jej kluczowe znaczenie dla problemu badawczego. Dla zmiennych
objaÅ›niajÄ…cych zastosowano wyrÃ³wnanie wartoÅ›ci odstajÄ…cych do progÃ³w
wyznaczonych na podstawie reguÅ‚y 1,5Â·IQR (winsoryzacja), co pozwoliÅ‚o
ograniczyÄ‡ wpÅ‚yw obserwacji ekstremalnych bez usuwania danych.
:::

## 3.2. Tworzenie nowych zmiennych

**MoÅ¼na dodaÄ‡ zmiennÄ… pochodnÄ…: room_changed = reserved_room_type !=
assigned_room_type**

## 3.3. Standaryzacja i normalizacja

# 4. ZASTOSOWANIE METOD WIELOWYMIAROWYCH

## 4.1. PCA â€“ Analiza gÅ‚Ã³wnych skÅ‚adowych

PCA umoÅ¼liwia redukcjÄ™ wymiarowoÅ›ci oraz ocenÄ™, ktÃ³re zmienne wyjaÅ›niajÄ…
najwiÄ™kszÄ… czÄ™Å›Ä‡ wariancji. ZostanÄ… przedstawione wartoÅ›ci wÅ‚asne,
wykres osypiska oraz biplot.

JeÅ›li stosowano metody redukcji wymiaru (np. PCA), opisz:

â€¢ jakie dane weszÅ‚y do analizy,

â€¢ ile skÅ‚adowych wybrano i dlaczego,

â€¢ jaka czÄ™Å›Ä‡ wariancji zostaÅ‚a wyjaÅ›niona.

## 4.2 Analiza skupieÅ„

ZostanÄ… zastosowane metody k-Å›rednich oraz hierarchiczna metoda Warda.
Wyniki obejmÄ… dendrogram, wykresy skupieÅ„ oraz interpretacjÄ™ klastrÃ³w
wzglÄ™dem zmiennych chemicznych.

# 5. PORÃ“WNANIE METOD I WIZUALIZACJE

PorÃ³wnane zostanÄ… wyniki PCA i klasteryzacji, a takÅ¼e ich interpretacje.
Wizualizacje obejmÄ… m.in. biploty, wykresy skupieÅ„ oraz wykresy 2D/3D
(kaÅ¼dy wykres powinien mieÄ‡ opis i krÃ³tki komentarz)
