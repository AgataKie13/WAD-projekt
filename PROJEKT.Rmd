---
title: "Wielowymiarowa analiza jakości wina na podstawie danych fizykochemicznych"
author: "Agata Kierznikowicz, Zuzanna Łomża"
date: "2025-12-05"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Biblioteki:
library(readr)
library(skimr)
library(dplyr)
library(corrplot) 
library(psych)  
library(ggplot2)
library(tidyr)
library(kableExtra)
library(broom)
```

# 1. Wprowadzenie

## 1.1. Motywacja i cel pracy

::: {style="text-align: justify;"}
Produkcja wina to proces, nad którym na co dzień rzadko się
zastanawiamy, choć sam napój towarzyszy wielu ważnym wydarzeniom.
Jednocześnie dostępne są obszerne dane opisujące właściwości chemiczne
win – zarówno czerwonych, jak i białych. Skoro dysponujemy tak bogatym
materiałem, warto z niego skorzystać, aby sprawdzić, które parametry
wpływają na jakość wina. W projekcie skupimy się jednak na jednym
wybranym zbiorze danych, aby analiza była bardziej przejrzysta. Wino
powstaje w wyniku szeregu złożonych procesów, które wymagają kontroli
wielu cech fizykochemicznych, takich jak kwasowość, zawartość alkoholu,
poziom cukrów resztkowych, gęstość czy pH. To właśnie te parametry w
dużej mierze decydują o ostatecznej ocenie trunku przez ekspertów.
Ponieważ zmiennych jest wiele i są ze sobą powiązane, trudno analizować
je pojedynczo, dlatego w projekcie zastosowano metody wielowymiarowej
analizy danych. Celem projektu jest lepsze zrozumienie zależności między
właściwościami wina oraz określenie, które z nich najbardziej wpływają
na jego jakość. W tym celu wykorzystano m.in. analizę PCA, metody
klasteryzacji oraz inne techniki eksploracyjne, które pomagają
uporządkować dane i wydobyć najważniejsze informacje.

**Główne cele projektu to:**

-   zbadanie zależności między właściwościami fizykochemicznymi wina,
-   identyfikacja zmiennych, które najsilniej wpływają na ocenę jakości,
-   zastosowanie PCA do redukcji wymiarowości i interpretacji
    składowych,
-   wykrycie naturalnych grup win przy użyciu metod analizy skupień
    (klastrów),
-   ocena przydatności zastosowanych metod w analizie jakości wina.
:::

## 1.2. Opis problemu badawczego

::: {style="text-align: justify;"}
Powyżej przedstawiony został ogólny zarys poruszanego problemu
badawczego. Nietrudno zauważyć, że zmiennych opisujących wino jest
wiele, a ich wzajemne relacje są złożone i trudne do oceny bez
odpowiednich metod statystycznych.

W związku z tym w projekcie należy odpowiedzieć na kilka głównych pytań:

-   Które parametry fizykochemiczne są ze sobą najsilniej powiązane?
-   Które zmienne w największym stopniu wpływają na ocenę jakości wina?
-   Czy dane wina można uporządkować w naturalne grupy, np. na podstawie
    podobieństwa chemicznego?
-   Czy redukcja wymiarowości (np. PCA) pozwala lepiej zrozumieć
    strukturę danych i uprościć ich interpretację?
:::

## 1.3. Opis danych

::: {style="text-align: justify;"}
Dane wykorzystane w projekcie pochodzą z bezpłatnego repozytorium UC
Irvine Machine Learning Repository i są dostępne pod adresem Wine
Quality. Zbiór dotyczy win z regionu Vinho Verde i stanowi kompletny
oraz liczny materiał, dobrze przystosowany do analiz wielowymiarowych.

*dostęp:* <https://archive.ics.uci.edu/dataset/186/wine+quality> P.
Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine
preferences by data mining from physicochemical properties. In Decision
Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

W projekcie wykorzystano część danych dotyczącą wina białego, obejmującą
4898 obserwacji oraz 12 zmiennych – 11 fizykochemicznych i jedną
wynikową quality, ocenianą w skali 0–10. Wszystkie zmienne objaśniające
mają charakter ilościowy, dzięki czemu możliwe jest stosowanie metod
opartych na macierzy korelacji, PCA oraz analizie klastrów. *Zmienne
objaśniające* (wejściowe) odzwierciedlają parametry chemiczne uzyskane w
testach laboratoryjnych, natomiast *zmienna objaśniana* (wyjściowa)
opiera się na sensorycznej ocenie jakości. Na podstawie artykułu
określono również, które zmienne objaśniające są *stymulantami*, a które
*destymulantami*. Struktura danych przedstawiona została poniżej.

*Zmienna objaśniana:*

-   **jakość** (ocena 0-10)

*Zmienne objaśniające:*

-   **stała kwasowość** destymulanta
-   **lotna kwasowość** destymulanta
-   **kwas cytrynowy** stymulanta
-   **cukier resztkowy** destymulanta
-   **chlorki** destymulanta
-   **wolny dwutlenek siarki** destymulanta
-   **całkowity dwutlenek siarki** destymulanta
-   **gęstość** destymulanta
-   **pH** stymulanta
-   **siarczany** stymulanta
-   **alkohol** stymulanta
:::

```{r wine, echo=FALSE, results='asis'}
wina <- read.csv("winequality-white.csv", header=TRUE, sep=';')
wina <- wina %>%
  rename(
    stała_kwasowość             = fixed.acidity,
    lotna_kwasowość             = volatile.acidity,
    kwas_cytrynowy              = citric.acid,
    cukier_resztkowy            = residual.sugar,
    chlorki                     = chlorides,
    wolny_dwutlenek_siarki      = free.sulfur.dioxide,
    całkowity_dwutlenek_siarki  = total.sulfur.dioxide,
    gęstość                     = density,
    pH                          = pH,
    siarczany                   = sulphates,
    alkohol                     = alcohol,
    jakość                      = quality
  )

stymulanty <- c("kwas_cytrynowy", "pH", "siarczany", "alkohol")
destymulanty <- c("stała_kwasowość", "lotna_kwasowość", "cukier_resztkowy", "chlorki", "wolny_dwutlenek_siarki", "całkowity_dwutlenek_siarki", "gęstość")

metadata <- tibble(
  zmienna = names(wina),
  typ_danych = sapply(wina, class),
  stymulanta_destymulanta = case_when(
    names(wina) %in% stymulanty ~ "stymulanta",
    names(wina) %in% destymulanty ~ "destymulanta",
    TRUE ~ "zmienna objaśniana"
  )
)

metadata %>%
  kable("html", digits = 2, caption = "Zmienne") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")

```

# 2. Analiza eksploracyjna danych

## 2.1. Podstawowe statystyki opisowe

```{r echo=FALSE}
num_cols <- sapply(wina, is.numeric)
vars <- names(wina)[num_cols]

summary_tbl <- data.frame(
  zmienna    = vars,
  min        = sapply(wina[vars], function(x) min(x, na.rm = TRUE)),
  max        = sapply(wina[vars], function(x) max(x, na.rm = TRUE)),
  średnia    = sapply(wina[vars], function(x) mean(x, na.rm = TRUE)),
  sd         = sapply(wina[vars], function(x) sd(x, na.rm = TRUE)),
  Q1         = sapply(wina[vars], function(x) quantile(x, 0.25, na.rm = TRUE)),
  mediana    = sapply(wina[vars], function(x) median(x, na.rm = TRUE)),
  Q3         = sapply(wina[vars], function(x) quantile(x, 0.75, na.rm = TRUE)),
  row.names  = NULL
)

summary_tbl %>%
  kable("html", digits = 2, caption = "Statystyki opisowe wina") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")
```

## 2.2. Analiza rozkładów

```{r echo=FALSE}
wina_long <- wina %>%
  select(where(is.numeric)) %>%
  pivot_longer(everything(),
               names_to = "zmienna",
               values_to = "value")

ggplot(wina_long, aes(x = value, fill = zmienna)) +
  geom_histogram(
    bins = 30,
    color = "white"
  ) +
  facet_wrap(~zmienna, scales = "free", nrow = 3) +
  labs(
    x = "Wartość",
    y = "Częstość"
  ) +
  scale_fill_brewer(palette = "Set3", guide = "none") +
  theme_minimal(base_size = 10) +
  theme(
    strip.background = element_rect(fill = "#f7f7f7", color = NA),
    strip.text = element_text(face = "bold", size = 9),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "#dddddd"),
    plot.title = element_text(face = "bold", size = 12)
  ) +
  labs(title = "Rozkłady zmiennych danych o winie")
```
::: {style="text-align: justify;"}
KOMENTARZ - Krótko skomentuj kształt rozkładu (skośność, obecność ogonów itp.)
:::

## 2.3. Analiza korelacji

```{r}
# 1. MACIERZ KORELACJI PEARSONA
macierz_korelacji <- cor(wina, method = "pearson")

# 1.2. WIZUALIZACJA MACIERZY KORELACJI
corrplot(macierz_korelacji, 
         method = "circle", 
         type = "upper",
         title = "Macierz korelacji - metoda kółek",
         mar = c(0,0,1,0))
```
::: {style="text-align: justify;"}
Z analizy macierzy korelacji można wywnioskować, że najsilniejsze zależności występują odpowiednio między ...
::::

### 2.3.1. Testy istotności korelacji

```{r}
cat("\n2. TESTY ISTOTNOŚCI KORELACJI:\n")
cat("\n2.1. Test istotności korelacji zmiennych cukier resztkowy i gęstość:\n")
cor_test_results2 <- cor.test(wina$cukier_resztkowy, wina$gęstość)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.2. Test istotności korelacji zmiennych gęstość i alkohol:\n")
cor_test_results2 <- cor.test(wina$gęstość, wina$alkohol)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.3. Test istotności korelacji zmiennych wolny dwutlenek siarki i całkowity dwutlenek siarki:\n")
cor_test_results2 <- cor.test(wina$wolny_dwutlenek_siarki, wina$całkowity_dwutlenek_siarki)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.4. Test istotności korelacji zmiennych całkowity dwutlenek siarki i gęstość:\n")
cor_test_results2 <- cor.test(wina$całkowity_dwutlenek_siarki, wina$gęstość)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.5. Test istotności korelacji zmiennych stała kwasowość i pH:\n")
cor_test_results2 <- cor.test(wina$stała_kwasowość, wina$pH)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")

cat("\n2.6. Test istotności korelacji zmiennych cukier resztkowy i alkohol:\n")
cor_test_results2 <- cor.test(wina$cukier_resztkowy, wina$alkohol)
cat("r =", round(cor_test_results2$estimate, 3), "\n")
cat("p-value =", round(cor_test_results2$p.value, 5), "\n")
```
::: {style="text-align: justify;"}
krótkie wnioski
::::

## 2.4. Analiza braków danych

```{r}
print(colSums(is.na(wina)))
```
::: {style="text-align: justify;"}
Zbiór nie zawiera braków danych
::::

## 2.5. Analiza obserwacji odstających

```{r}
wina_long <- wina %>%
  select(where(is.numeric)) %>%
  pivot_longer(
    cols = everything(),
    names_to = "zmienna",
    values_to = "value"
  )

ggplot(wina_long, aes(y = value)) +
  geom_boxplot(
    fill = "#8DA0CB",
    color = "#4A4A4A",
    outlier.color = "#D95F02",
    outlier.alpha = 0.6
  ) +
  facet_wrap(
    ~ zmienna,
    scales = "free_y",
    nrow = 3
  ) +
  labs(
    x = NULL,
    y = "Wartość",
    title = "Analiza wartości odstających"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    strip.background = element_rect(fill = "#f7f7f7", color = NA),
    strip.text = element_text(face = "bold", size = 9),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    plot.title = element_text(face = "bold", size = 12)
  )


```
::: {style="text-align: justify;"}
Analiza rozkładów zmiennych oraz wstępna analiza odchyleń z wykorzystaniem boxplotów pozwoliła zlokalizować zmienne zawierające odchylenia. Wśród nich znajdują się wszystkie zmienne z wyjątkiem zmiennej alkohol.\
Następnie przeprowadzono wielowymiarową analizę odchyleń z wykorzystaniem relacji między zmienną objaśnianą - jakość a zmiennymi objaśniającymi.
::::

```{r}
layout(matrix(c(1, 2), nrow = TRUE, byrow = 2), heights = c(1, 1, 1))
fit1 = lm(jakość ~ całkowity_dwutlenek_siarki,data=wina)
plot(fit1,which=4, main="Jakość vs całkowity\ndwutlenek siarki")

fit2 = lm(jakość ~ wolny_dwutlenek_siarki,data=wina)
plot(fit2,which=4, main="Jakość vs wolny\ndwutlenek siarki")

fit3 = lm(jakość ~ lotna_kwasowość,data=wina)
plot(fit3,which=4, main="Jakość vs lotna kwasowość")

fit4 = lm(jakość ~ stała_kwasowość,data=wina)
plot(fit4,which=4, main="Jakość vs stała kwasowość")

fit5 = lm(jakość ~ chlorki,data=wina)
plot(fit5,which=4, main="Jakość vs chlorki")

fit6 = lm(jakość ~ cukier_resztkowy,data=wina)
plot(fit6,which=4, main="Jakość vs cukier resztkowy")

fit7 = lm(jakość ~ gęstość,data=wina)
plot(fit7,which=4, main="Jakość vs gęstość")

fit8 = lm(jakość ~ kwas_cytrynowy,data=wina)
plot(fit8,which=4, main="Jakość vs kwas cytrynowy")

fit9 = lm(jakość ~ pH,data=wina)
plot(fit9,which=4, main="Jakość vs pH")

fit10 = lm(jakość ~ siarczany,data=wina)
plot(fit10,which=4, main="Jakość vs siarczany")

```
[z innego projektu
Dystans Cooka mierzy wpływ pojedynczej obserwacji na dopasowanie modelu. Na osi Y przedstawiane są wartości Cook's Distance, a na osi X liczba obserwacji.\
Dla wykresu **Kwota kredytu vs Dochód wnioskodawcy** Dystans Cooka jest większy od 1, co oznacza, że taki punkt może być uznawany za odstający. W pozostałych pryzpadkach wartości wskaźnika są mniejsze od 1.\
Punkty znajdujące się blisko OX mają niewielki wpływ na na model, dzięki czemu można uznać je za normalne. Na każdym wykresie znajduje się kilka istotnie wykraczających wartości, które pozostały po przeprowadzonej walidacji i analizie braków danych.]
::::

# 3. Obróbka zmiennych

## 3.1. Obsługa obserwacji odstających - jeśli występują

!na razie kod z czatu - trzeba przejrzeć zajęcia czy czegoś nie było!

```{r}


```

## 3.2. Tworzenie nowych zmiennych

## 3.3. Standaryzacja i normalizacja

# 4. ZASTOSOWANIE METOD WIELOWYMIAROWYCH 

## 4.1. PCA – Analiza głównych składowych 

PCA umożliwia redukcję wymiarowości oraz ocenę, które zmienne wyjaśniają największą część wariancji. Zostaną przedstawione wartości własne, wykres osypiska oraz biplot. 

Jeśli stosowano metody redukcji wymiaru (np. PCA), opisz: 

• jakie dane weszły do analizy, 

• ile składowych wybrano i dlaczego, 

• jaka część wariancji została wyjaśniona. 

## 4.2 Analiza skupień 

Zostaną zastosowane metody k-średnich oraz hierarchiczna metoda Warda. Wyniki obejmą dendrogram, wykresy skupień oraz interpretację klastrów względem zmiennych chemicznych. 

# 5. PORÓWNANIE METOD I WIZUALIZACJE 

Porównane zostaną wyniki PCA i klasteryzacji, a także ich interpretacje. Wizualizacje obejmą m.in. biploty, wykresy skupień oraz wykresy 2D/3D (każdy wykres powinien mieć opis i krótki komentarz)



